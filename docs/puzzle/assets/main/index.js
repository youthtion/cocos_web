System.register("chunks:///_virtual/GameController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts","./PuzzleController.ts"],(function(e){var t,n,r,l,i,a,o,u,s,h,c,f,p,z,g,d,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,l=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,o=e.Prefab,u=e.Node,s=e.Label,h=e.instantiate,c=e.Sprite,f=e.Component},function(e){p=e.GameModel,z=e.CELL_WIDTH,g=e.BOARD_COLOR,d=e.ADD_NEAR_RATE},function(e){b=e.PuzzleController}],execute:function(){var v,C,P,m,y,L,M,B,R,F,N,_,w;i._RF.push({},"7e675OHFblFTawCzOgyllbA","GameController",void 0);var A=a.ccclass,D=a.property;e("GameController",(v=A("GameController"),C=D({type:o}),P=D({type:b}),m=D({type:u}),y=D({type:s}),L=D({type:s}),v((R=t((B=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,r(t,"cellPrefab",R,l(t)),r(t,"puzzleCtrl",F,l(t)),r(t,"startMenu",N,l(t)),r(t,"btnLabel",_,l(t)),r(t,"titleLabel",w,l(t)),t}n(t,e);var i=t.prototype;return i.start=function(){var e,t;this.restart(),null==(e=this.puzzleCtrl)||e.node.on("onFitPuzzle",this.onFitPuzzle,this),null==(t=this.puzzleCtrl)||t.node.on("onRemovePuzzle",this.onRemovePuzzle,this)},i.restart=function(){var e;this.initBoard(),null==(e=this.puzzleCtrl)||e.initPuzzle()},i.update=function(e){},i.initBoard=function(){var e=p.getBoardLength();if(this.cellPrefab){var t=[];this.node.removeAllChildren();for(var n=0;n<e;n++){for(var r=[],l=0;l<e;l++){var i=h(this.cellPrefab);if(i){this.node.addChild(i),i.setPosition(n*z,l*z,0);var a=i.getComponent(c);a&&(a.color=g),r.push(-1)}}t.push(r)}p.setBoard(t);var o=e*z*-.5+.5*z;this.node.setPosition(o,o,0),this.generatePuzzle(t)}},i.generatePuzzle=function(e){for(var t=[],n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++)if(-1==e[n][r]&&(t.push([[n,r]]),e[n][r]=t.length-1,this.addNearCell(t,e),t[t.length-1].length<=1)){var l=t[t.length-1][0],i=l[0],a=l[1],o=this.findNearPuzzle(e,i,a);t[o].push(t[t.length-1][0]),t.pop(),e[i][a]=o}p.setPuzzles(t)},i.addNearCell=function(e,t){for(var n=e.length-1,r=e[n],l=t.map((function(e){return e.slice()})),i=[],a=[[1,0],[0,1]],o=0;o<r.length;o++)for(var u=r[o],s=u[0],h=u[1],c=0;c<a.length;c++){var f=a[c],p=s+f[0],z=h+f[1];p<l.length&&z<l[p].length&&-1==l[p][z]&&(i.push([p,z]),l[p][z]=0)}if(i.length>0&&r.length<d.length&&Math.random()<d[r.length]){var g=Math.floor(Math.random()*i.length),b=i[g],v=b[0],C=b[1];e[n].push(i[g]),t[v][C]=n,this.addNearCell(e,t)}},i.findNearPuzzle=function(e,t,n){for(var r=[[-1,0],[1,0],[0,1],[0,-1]],l=[],i=0;i<r.length;i++){var a=r[i],o=t+a[0],u=n+a[1];o>=0&&u>=0&&o<e.length&&u<e[o].length&&l.push([o,u])}var s=l[Math.floor(Math.random()*l.length)],h=s[0],c=s[1];return e[h][c]},i.onFitPuzzle=function(e,t){for(var n,r=parseInt(t),l=p.getBoard().map((function(e){return e.slice()})),i=0;i<e.length;i++){var a,o=e[i],u=o[0],s=o[1];if(-1!=l[u][s])return void(null==(a=this.puzzleCtrl)||a.onFitPuzzleCallback(!1));l[u][s]=r}p.setBoard(l),null==(n=this.puzzleCtrl)||n.onFitPuzzleCallback(!0),this.checkResult(l)},i.onRemovePuzzle=function(e,t){for(var n=parseInt(t),r=p.getBoard().map((function(e){return e.slice()})),l=0;l<e.length;l++){var i=e[l],a=i[0],o=i[1];if(r[a][o]!=n)return;r[a][o]=-1}p.setBoard(r)},i.checkResult=function(e){for(var t=0;t<e.length;t++)for(var n=0;n<e[t].length;n++)if(-1==e[t][n])return;this.setMenuVisible(!0),this.btnLabel&&(this.btnLabel.string="Next"),this.titleLabel&&(this.titleLabel.string="Congraduration!"),p.setBoardLength(p.getBoardLength()+1),this.restart()},i.onStartButtonClicked=function(){this.setMenuVisible(!1)},i.setMenuVisible=function(e){this.startMenu&&(this.startMenu.active=e)},t}(f)).prototype,"cellPrefab",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(B.prototype,"puzzleCtrl",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(B.prototype,"startMenu",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(B.prototype,"btnLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(B.prototype,"titleLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=B))||M));i._RF.pop()}}}));

System.register("chunks:///_virtual/GameModel.ts",["cc"],(function(t){var e,n;return{setters:[function(t){e=t.cclegacy,n=t.Color}],execute:function(){e._RF.push({},"3ed4fPz+JtG/7O1tueJ7qje","GameModel",void 0);t("CELL_WIDTH",60),t("FIT_ALLOW",12),t("BOARD_COLOR",new n(64,64,64)),t("ADD_NEAR_RATE",[1,1,1,.7,.5,.2]);var r=t("CGameModel",function(){function t(){this.boardLength=3,this.board=[],this.puzzles=[]}var e=t.prototype;return e.setBoardLength=function(t){this.boardLength=t},e.getBoardLength=function(){return this.boardLength},e.setBoard=function(t){this.board=t.map((function(t){return t.slice()}))},e.getBoard=function(){return this.board},e.setPuzzles=function(t){this.puzzles=t.map((function(t){return t.map((function(t){return t.slice()}))}))},e.getPuzzles=function(){return this.puzzles},t}());t("GameModel",new r);e._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./GameController.ts","./GameModel.ts","./PuzzleController.ts"],(function(){return{setters:[null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PuzzleController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts"],(function(e){var t,n,o,i,l,r,a,s,u,h,g,c,z,f,P,p,d,M,v,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){l=e.cclegacy,r=e._decorator,a=e.Prefab,s=e.CCFloat,u=e.input,h=e.Input,g=e.Vec3,c=e.UITransform,z=e.Color,f=e.Node,P=e.instantiate,p=e.Sprite,d=e.Component},function(e){M=e.GameModel,v=e.CELL_WIDTH,y=e.FIT_ALLOW}],execute:function(){var b,C,T,m,S,_,x,I,E;l._RF.push({},"4b28053qTlNFqEjoH7O1aS0","PuzzleController",void 0);var L=r.ccclass,U=r.property,w=function(e){return e[e.MT_LEFT=0]="MT_LEFT",e[e.MT_MID=1]="MT_MID",e[e.MT_RIGHT=2]="MT_RIGHT",e}(w||{});e("PuzzleController",(b=L("PuzzleController"),C=U({type:a}),T=U({type:s,min:0,max:1,step:.01}),m=U({type:s,min:0,max:1,step:.01}),b((x=t((_=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return t=e.call.apply(e,[this].concat(l))||this,o(t,"cellPrefab",x,i(t)),o(t,"cellSaturation",I,i(t)),o(t,"cellLightness",E,i(t)),t.fitCells=[],t.fitPuzzlePos=[0,0],t.dragPuzzle=null,t.dragStartPos=new g,t.puzzleStartPos=new g,t}n(t,e);var l=t.prototype;return l.start=function(){u.on(h.EventType.MOUSE_MOVE,this.onMouseMove,this),u.on(h.EventType.MOUSE_UP,this.onMouseUp,this)},l.update=function(e){},l.initPuzzle=function(){var e=this;if(this.cellPrefab){var t=M.getBoard(),n=M.getPuzzles().map((function(e){return e.map((function(e){return e.slice()}))}));this.node.removeAllChildren();for(var o=this.generateHueColors(n.length),i=function(){for(var i=new f(""+l),r=n[l][0],a=r[0],s=r[1],u=0;u<n[l].length;u++){var c=P(e.cellPrefab);if(c){i.addChild(c);var z=n[l][u],d=z[0],M=z[1];c.setPosition((d-a)*v,(M-s)*v,0);var y=c.getComponent(p);y&&(y.color=o[l]),c.on(h.EventType.MOUSE_DOWN,(function(t){e.onMouseDown(t,i)}),e),c.on(h.EventType.MOUSE_MOVE,e.onMouseMove,e),c.on(h.EventType.MOUSE_UP,e.onMouseUp,e)}}i.eulerAngles=new g(i.eulerAngles.x,i.eulerAngles.y,i.eulerAngles.z+90*Math.floor(4*Math.random())),i.setPosition(t.length*v*-1,0,0),e.node.addChild(i)},l=0;l<n.length;l++)i()}},l.onMouseDown=function(e,t){if(t.parent)if(t.setSiblingIndex(t.parent.children.length-1),this.getFitCell(t),this.fitCells.length==t.children.length&&this.node.emit("onRemovePuzzle",this.fitCells,t.name),e.getButton()==w.MT_RIGHT){var n=new g(e.getUILocation().x,e.getUILocation().y,0),o=t.parent.getComponent(c).convertToNodeSpaceAR(n),i=t.getPosition(),l=new g(o.x-i.x,o.y-i.y,0),r=[Math.cos(Math.PI/-2),Math.sin(Math.PI/-2)],a=r[0],s=r[1],u=l.x*a-l.y*s,h=l.x*s+l.y*a,z=o.x-u,f=o.y-h;t.setPosition(z,f,0),t.eulerAngles=new g(t.eulerAngles.x,t.eulerAngles.y,(t.eulerAngles.z-90)%360)}else e.getButton()!=w.MT_LEFT||this.dragPuzzle||(this.puzzleStartPos.set(t.getPosition()),this.dragStartPos.set(e.getUILocation().x,e.getUILocation().y,0),this.dragPuzzle=t)},l.onMouseMove=function(e){if(this.dragPuzzle){var t=e.getUILocation(),n=this.dragStartPos.x-t.x,o=this.dragStartPos.y-t.y;this.dragPuzzle.setPosition(this.puzzleStartPos.x-n,this.puzzleStartPos.y-o)}},l.onMouseUp=function(e){if(this.dragPuzzle){if(this.dragPuzzle.parent&&(this.getFitCell(this.dragPuzzle),this.fitCells.length==this.dragPuzzle.children.length))return void this.node.emit("onFitPuzzle",this.fitCells,this.dragPuzzle.name);this.dragPuzzle=null}},l.getFitCell=function(e){var t=0,n=0;this.fitCells=[];for(var o=M.getBoard(),i=0;i<e.children.length;i++){var l=e.children[i].getWorldPosition(),r=e.parent.getComponent(c).convertToNodeSpaceAR(l),a=[r.x,r.y],s=a[0],u=a[1];if(Math.abs(s)>v*(o.length-1)/2+y||Math.abs(u)>v*(o.length-1)/2+y)break;if(o.length%2==0){var h=[s+.5*v,u+.5*v];s=h[0],u=h[1]}if(Math.abs(s%v)>y&&Math.abs(s%v)<v-y)break;if(Math.abs(u%v)>y&&Math.abs(u%v)<v-y)break;if(0==t&&0==n){(t=(s%v+v)%v)>y&&(t-=v),(n=(u%v+v)%v)>y&&(n-=v);var g=e.getPosition();this.fitPuzzlePos=[g.x-t,g.y-n]}this.fitCells.push([Math.round((s-t)/v+Math.floor((o.length-1)/2)),Math.round((u-n)/v+Math.floor((o.length-1)/2))])}},l.onFitPuzzleCallback=function(e){this.dragPuzzle&&e&&(this.dragPuzzle.setPosition(this.fitPuzzlePos[0],this.fitPuzzlePos[1],0),this.fitPuzzlePos=[0,0]),this.dragPuzzle=null},l.hslToRgb=function(e,t,n){var o,i,l;if(0==t)o=i=l=n;else{var r=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:s},a=n<.5?n*(1+t):n+t-n*t,s=2*n-a;o=r(s,a,e+1/3),i=r(s,a,e),l=r(s,a,e-1/3)}return[255*o,255*i,255*l]},l.generateHueColors=function(e){for(var t=[],n=0;n<e;n++){var o=n/e,i=this.hslToRgb(o,this.cellSaturation,this.cellLightness),l=i[0],r=i[1],a=i[2];t.push(new z(l,r,a))}return t},t}(d)).prototype,"cellPrefab",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(_.prototype,"cellSaturation",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),E=t(_.prototype,"cellLightness",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S=_))||S));l._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});