System.register("chunks:///_virtual/BuffController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts"],(function(t){var f,e,i,u,s,r,B,n,_,b,h,a,l,U,L,o,E,p;return{setters:[function(t){f=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,u=t.assertThisInitialized},function(t){s=t.cclegacy,r=t._decorator,B=t.Node,n=t.Label,_=t.Sprite,b=t.CCInteger,h=t.SpriteAtlas,a=t.Component},function(t){l=t.GameModel,U=t.EBuffType,L=t.MIN_BOARD_LENGTH,o=t.MAX_BOARD_LENGTH,E=t.EGameEvents,p=t.ADD_NEAR_RATE}],execute:function(){var c,S,A,O,R,T,g,F,D,C,d,Z,N,m,y,G,P,v,w,H,M,I,z,Y,k,W,X,V,x;s._RF.push({},"efd9cZ2vtdGkZunZzVclwQC","BuffController",void 0);var j=r.ccclass,Q=r.property,q=function(t){return t[t.BU_GROW_STOP=0]="BU_GROW_STOP",t[t.BU_GROW_DEC=1]="BU_GROW_DEC",t[t.BU_SMALLER_PUZZLE=2]="BU_SMALLER_PUZZLE",t[t.BU_BIGGER_PUZZLE=3]="BU_BIGGER_PUZZLE",t[t.BU_LESS_HUE=4]="BU_LESS_HUE",t[t.BU_MORE_HUE=5]="BU_MORE_HUE",t[t.BU_ADD_OBSTACLE=6]="BU_ADD_OBSTACLE",t[t.BU_DEC_OBSTACLE=7]="BU_DEC_OBSTACLE",t[t.BU_GET_1X1_PUZZLE=8]="BU_GET_1X1_PUZZLE",t[t.BU_LOSE_1X1_PUZZLE=9]="BU_LOSE_1X1_PUZZLE",t[t.BU_CANNOT_ROTATE=10]="BU_CANNOT_ROTATE",t[t.BU_LESS_BUFF=11]="BU_LESS_BUFF",t[t.BU_BUFF_START=11]="BU_BUFF_START",t[t.BU_ONE_BUFF=12]="BU_ONE_BUFF",t[t.BU_TWO_BUFF=13]="BU_TWO_BUFF",t[t.BU_THREE_BUFF=14]="BU_THREE_BUFF",t[t.BU_MORE_BUFF=15]="BU_MORE_BUFF",t[t.BU_REFRESH=16]="BU_REFRESH",t[t.BU_GRAVITY=17]="BU_GRAVITY",t[t.BU_BUOYANCY=18]="BU_BUOYANCY",t[t.BU_PASS=19]="BU_PASS",t}(q||{});t("BuffController",(c=j("BuffController"),S=Q({type:B}),A=Q({type:n}),O=Q({type:B}),R=Q({type:B}),T=Q({type:B}),g=Q({type:n}),F=Q({type:n}),D=Q({type:n}),C=Q({type:_}),d=Q({type:_}),Z=Q({type:_}),N=Q({type:b}),m=Q({type:h}),c((P=f((G=function(t){function f(){for(var f,e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return f=t.call.apply(t,[this].concat(s))||this,i(f,"refreshBtn",P,u(f)),i(f,"freshLabel",v,u(f)),i(f,"buffBtn1",w,u(f)),i(f,"buffBtn2",H,u(f)),i(f,"buffBtn3",M,u(f)),i(f,"buffLabel1",I,u(f)),i(f,"buffLabel2",z,u(f)),i(f,"buffLabel3",Y,u(f)),i(f,"buffSprite1",k,u(f)),i(f,"buffSprite2",W,u(f)),i(f,"buffSprite3",X,u(f)),i(f,"buffSpace",V,u(f)),i(f,"buffAtlas",x,u(f)),f.buffBtns=[],f.buffLabels=[],f.buffSprites=[],f.buffList=[],f.buffNum=2,f.refreshNum=0,f.buffText=["底板不擴大(1場)","底板縮小","小方塊變多","大方塊變多","方塊色差小","方塊色差大","底板缺格增加","底板缺格減少","獲得1x1方塊","失去1x1方塊\n出現底板縮小","不可旋轉(1場)\n出現底板縮小","選項減少\n獲得刷新次數","","","","選項增加","刷新選項","產生重力(1場)","產生浮力(1場)","跳過"],f}e(f,t);var s=f.prototype;return s.start=function(){this.buffBtn1&&this.buffBtns.push(this.buffBtn1),this.buffBtn2&&this.buffBtns.push(this.buffBtn2),this.buffBtn3&&this.buffBtns.push(this.buffBtn3),this.buffLabel1&&this.buffLabels.push(this.buffLabel1),this.buffLabel2&&this.buffLabels.push(this.buffLabel2),this.buffLabel3&&this.buffLabels.push(this.buffLabel3),this.buffSprite1&&this.buffSprites.push(this.buffSprite1),this.buffSprite2&&this.buffSprites.push(this.buffSprite2),this.buffSprite3&&this.buffSprites.push(this.buffSprite3)},s.update=function(t){},s.showBuffBtn=function(){for(var t=0;t<this.buffBtns.length;t++)if(this.buffNum>t){this.buffBtns[t].active=!0,this.buffBtns[t].setPosition(this.buffSpace*(this.buffNum-1)*-.5+t*this.buffSpace,0,0),this.buffLabels[t].string=this.buffText[this.buffList[t]];var f=this.buffList[t];this.buffList[t]==q.BU_LESS_BUFF?f=q.BU_BUFF_START+(this.buffNum-1):this.buffList[t]==q.BU_MORE_BUFF&&(f=q.BU_BUFF_START+(this.buffNum+1)),this.buffSprites[t].spriteFrame=this.buffAtlas.getSpriteFrame(""+f)}else this.buffBtns[t].active=!1;this.refreshBtn&&(this.refreshBtn.active=this.refreshNum>0,this.freshLabel&&(this.freshLabel.string=""+this.refreshNum))},s.onBuffClick=function(t,f){this.setBuff(f)},s.onRefreshClick=function(){this.refreshNum-=1,this.generateBuffList(),this.showBuffBtn()},s.getBuffAddNearRate=function(){for(var t=p.slice(),f=3;f<t.length;f++)t[f]+=.1*l.getBuff(U.BD_SIZE),t[f]>1?t[f]=1:t[f]<0&&(t[f]=0);return t},s.setBuff=function(t){var f=this.buffList[t];switch(f){case q.BU_GROW_DEC:l.getBoardLength()>L&&l.decreaseBoardLength();break;case q.BU_SMALLER_PUZZLE:l.decreaseBuff(U.BD_SIZE);break;case q.BU_BIGGER_PUZZLE:l.addBuff(U.BD_SIZE);break;case q.BU_LESS_HUE:l.addBuff(U.BD_HUE);break;case q.BU_MORE_HUE:l.decreaseBuff(U.BD_HUE);break;case q.BU_ADD_OBSTACLE:l.addBuff(U.BD_OBSTACLE);break;case q.BU_DEC_OBSTACLE:l.decreaseBuff(U.BD_OBSTACLE);break;case q.BU_GET_1X1_PUZZLE:l.addBuff(U.BD_ONECELL);break;case q.BU_LOSE_1X1_PUZZLE:return l.decreaseBuff(U.BD_ONECELL),this.buffList[t]=q.BU_GROW_DEC,void this.showBuffBtn();case q.BU_CANNOT_ROTATE:return l.setBuff(U.BD_ROTATE,1),this.buffList[t]=q.BU_GROW_DEC,void this.showBuffBtn();case q.BU_LESS_BUFF:return this.buffNum-=1,this.refreshNum+=1,this.buffList.splice(t,1),void this.showBuffBtn();case q.BU_MORE_BUFF:this.buffNum+=1;var e=[this.buffList[this.buffList.length-1],this.buffList[t]];return this.buffList[t]=e[0],this.buffList[this.buffList.length-1]=e[1],void this.showBuffBtn();case q.BU_REFRESH:return this.generateBuffList(),void this.showBuffBtn();case q.BU_GRAVITY:l.setBuff(U.BD_GRAVITY,1);break;case q.BU_BUOYANCY:l.setBuff(U.BD_GRAVITY,-1)}f>q.BU_GROW_DEC&&l.getBoardLength()<o&&l.addBoardLength(),this.node.emit(E.GE_ADD_BUFF)},s.generateBuffList=function(){this.buffList=[],l.getBoardLength()<o&&this.buffList.push(q.BU_GROW_STOP),l.getBuff(U.BD_SIZE)>-3&&this.buffList.push(q.BU_SMALLER_PUZZLE),l.getBuff(U.BD_SIZE)<3&&this.buffList.push(q.BU_BIGGER_PUZZLE),this.buffList.push(q.BU_LESS_HUE),l.getBuff(U.BD_HUE)>0&&this.buffList.push(q.BU_MORE_HUE),l.getBuff(U.BD_OBSTACLE)<4&&this.buffList.push(q.BU_ADD_OBSTACLE),l.getBuff(U.BD_OBSTACLE)>0&&this.buffList.push(q.BU_DEC_OBSTACLE),l.getBuff(U.BD_ONECELL)<5&&this.buffList.push(q.BU_GET_1X1_PUZZLE),l.getBoardLength()>L&&(l.getBuff(U.BD_ONECELL)>0&&this.buffList.push(q.BU_LOSE_1X1_PUZZLE),0==l.getBuff(U.BD_ROTATE)&&this.buffList.push(q.BU_CANNOT_ROTATE)),this.buffNum>1&&this.buffList.push(q.BU_LESS_BUFF),this.buffNum<3&&this.buffList.push(q.BU_MORE_BUFF),this.buffList.push(q.BU_REFRESH),0==l.getBuff(U.BD_GRAVITY)&&(this.buffList.push(q.BU_GRAVITY),this.buffList.push(q.BU_BUOYANCY)),this.buffList.push(q.BU_PASS);for(var t=0;t<this.buffList.length;t++){var f=Math.floor(Math.random()*(this.buffList.length-t))+t,e=[this.buffList[f],this.buffList[t]];this.buffList[t]=e[0],this.buffList[f]=e[1]}},f}(a)).prototype,"refreshBtn",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=f(G.prototype,"freshLabel",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=f(G.prototype,"buffBtn1",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=f(G.prototype,"buffBtn2",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=f(G.prototype,"buffBtn3",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=f(G.prototype,"buffLabel1",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=f(G.prototype,"buffLabel2",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=f(G.prototype,"buffLabel3",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=f(G.prototype,"buffSprite1",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=f(G.prototype,"buffSprite2",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=f(G.prototype,"buffSprite3",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=f(G.prototype,"buffSpace",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),x=f(G.prototype,"buffAtlas",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=G))||y));s._RF.pop()}}}));

System.register("chunks:///_virtual/GameController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts","./PuzzleController.ts","./BuffController.ts"],(function(t){var e,r,n,i,l,a,o,s,u,h,f,c,p,g,v,z,b,d,B,C,P,E,m,y,L;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,n=t.initializerDefineProperty,i=t.assertThisInitialized,l=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){o=t.cclegacy,s=t._decorator,u=t.Color,h=t.Prefab,f=t.Node,c=t.Label,p=t.EditBox,g=t.instantiate,v=t.Sprite,z=t.Component},function(t){b=t.EGameEvents,d=t.GameModel,B=t.EBuffType,C=t.CELL_WIDTH,P=t.ADD_NEAR_RATE,E=t.MIN_BOARD_LENGTH,m=t.MAX_BOARD_LENGTH},function(t){y=t.PuzzleController},function(t){L=t.BuffController}],execute:function(){var M,_,A,w,S,T,D,G,k,I,N,R,O,H,V,Z,x,F,U,Y,K,$,j,W,X;o._RF.push({},"7e675OHFblFTawCzOgyllbA","GameController",void 0);var q=s.ccclass,J=s.property,Q=new u(64,64,64),tt=new u(0,0,0);t("GameController",(M=q("GameController"),_=J({type:h}),A=J({type:y}),w=J({type:L}),S=J({type:f}),T=J({type:f}),D=J({type:c}),G=J({type:c}),k=J({type:f}),I=J({type:f}),N=J({type:p}),R=J({type:f}),M((V=e((H=function(t){function e(){for(var e,r=arguments.length,l=new Array(r),a=0;a<r;a++)l[a]=arguments[a];return e=t.call.apply(t,[this].concat(l))||this,n(e,"cellPrefab",V,i(e)),n(e,"puzzleCtrl",Z,i(e)),n(e,"buffCtrl",x,i(e)),n(e,"startMenu",F,i(e)),n(e,"btnStart",U,i(e)),n(e,"titleLabel",Y,i(e)),n(e,"stageLabel",K,i(e)),n(e,"shareBtn",$,i(e)),n(e,"shareMenu",j,i(e)),n(e,"shareEdit",W,i(e)),n(e,"screenshotBtn",X,i(e)),e}r(e,t);var o=e.prototype;return o.start=function(){var t;this.checkHelpMode(),null==(t=this.buffCtrl)||t.node.on(b.GE_ADD_BUFF,this.onStartButtonClicked,this)},o.restart=function(){var t,e;this.setMenuVisible(!1),this.stageLabel&&(this.stageLabel.string="Stage"+d.getStage()),this.initBoard(),this.generatePuzzle(),null==(t=this.puzzleCtrl)||t.initPuzzle(),null==(e=this.puzzleCtrl)||e.setEventsActive(!0),this.setEventsActive(!0)},o.pause=function(){var t,e,r;this.setMenuVisible(!0),this.btnStart&&(this.btnStart.active=!1),this.titleLabel&&(this.titleLabel.string=""),this.stageLabel&&(this.stageLabel.string=""),d.addStage(),d.removeBuff(B.BD_ROTATE),d.removeBuff(B.BD_GRAVITY),null==(t=this.buffCtrl)||t.generateBuffList(),null==(e=this.buffCtrl)||e.showBuffBtn(),null==(r=this.puzzleCtrl)||r.setEventsActive(!1),this.setEventsActive(!1)},o.update=function(t){},o.setEventsActive=function(t){var e,r,n,i;t?(null==(e=this.puzzleCtrl)||e.node.on(b.GE_PLACE_PUZZLE,this.onPlacePuzzle,this),null==(r=this.puzzleCtrl)||r.node.on(b.GE_PICK_PUZZLE,this.onPickPuzzle,this)):(null==(n=this.puzzleCtrl)||n.node.off(b.GE_PLACE_PUZZLE,this.onPlacePuzzle,this),null==(i=this.puzzleCtrl)||i.node.off(b.GE_PICK_PUZZLE,this.onPickPuzzle,this))},o.initBoard=function(t){if(void 0===t&&(t=new Set),this.cellPrefab){var e=d.getBoardLength(),r=[];if(this.node.removeAllChildren(),0==t.size&&d.getBuff(B.BD_OBSTACLE)>0)for(var n=d.getBuff(B.BD_OBSTACLE),i=Math.floor(e*e/n),l=0;l<n;l++)t.add(Math.floor(Math.random()*i)+i*l);for(var a=0;a<e;a++){for(var o=[],s=0;s<e;s++){var u=g(this.cellPrefab);if(u){this.node.addChild(u),u.setPosition(a*C,s*C,0);var h=u.getComponent(v);t.size>0&&t.has(a*e+s)?(h&&(h.color=tt),o.push(1/0)):(h&&(h.color=Q),o.push(-1))}}r.push(o)}d.setBoard(r);var f=e*C*-.5+.5*C;this.node.setPosition(f,f,0)}},o.generatePuzzle=function(){for(var t=d.getBoard().map((function(t){return t.slice()})),e=[],r=d.getBuff(B.BD_ONECELL),n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)if(-1==t[n][i]){var l=e.length;if(e.push([[n,i]]),r>0)t[n][i]=1/0,r--;else if(t[n][i]=l,this.addNearCell(e,t),e[l].length<=1){var a=e[l][0],o=a[0],s=a[1],u=this.findNearPuzzle(t,o,s);e[u].push(e[l][0]),e.pop(),t[o][s]=u}}d.setPuzzles(e)},o.addNearCell=function(t,e){for(var r=t.length-1,n=t[r],i=e.map((function(t){return t.slice()})),l=[],a=[[1,0],[0,1]],o=0;o<n.length;o++)for(var s=n[o],u=s[0],h=s[1],f=0;f<a.length;f++){var c=a[f],p=u+c[0],g=h+c[1];p<i.length&&g<i[p].length&&-1==i[p][g]&&(l.push([p,g]),i[p][g]=0)}if(l.length>0&&n.length<P.length){var v,z=null==(v=this.buffCtrl)?void 0:v.getBuffAddNearRate().slice();if(Math.random()<z[n.length]){var b=Math.floor(Math.random()*l.length),d=l[b],B=d[0],C=d[1];t[r].push(l[b]),e[B][C]=r,this.addNearCell(t,e)}}},o.findNearPuzzle=function(t,e,r){for(var n=[[-1,0],[1,0],[0,1],[0,-1]],i=[],l=0;l<n.length;l++){var a=n[l],o=e+a[0],s=r+a[1];o>=0&&s>=0&&o<t.length&&s<t[o].length&&t[o][s]>-1&&t[o][s]!=1/0&&i.push([o,s])}if(i.length>0){var u=i[Math.floor(Math.random()*i.length)],h=u[0],f=u[1];return t[h][f]}return 0},o.onPlacePuzzle=function(t,e){for(var r,n=d.getBuff(B.BD_GRAVITY),i=1/0,l=-1,a=0;a<t.length;a++)t[a][1]<i&&(i=t[a][1]),t[a][1]>l&&(l=t[a][1]);var o=d.getBoard().map((function(t){return t.slice()})),s=null,u=0;n>0?u=i-0:n<0&&(u=o.length-1-l);for(var h=0;h<=u;h++){for(var f=0,c=0;c<t.length;c++){var p=t[c],g=p[0],v=p[1];if(-1!=o[g][v-h*n])break;f++}if(f!=t.length)break;s=h*n}if(null!=s){for(var z=parseInt(e),b=0;b<t.length;b++){var C=t[b],P=C[0],E=C[1];o[P][E-s]=z}d.setBoard(o),null==(r=this.puzzleCtrl)||r.onPlacePuzzleCallback(s),this.checkResult(o)}else{var m;null==(m=this.puzzleCtrl)||m.onPlacePuzzleCallback(s)}},o.onPickPuzzle=function(t,e){for(var r=parseInt(e),n=d.getBoard().map((function(t){return t.slice()})),i=0;i<t.length;i++){var l=t[i],a=l[0],o=l[1];if(n[a][o]!=r)return;n[a][o]=-1}d.setBoard(n)},o.onStartButtonClicked=function(){this.restart()},o.checkResult=function(t){if(!d.getHelpMode()){for(var e=0;e<t.length;e++)for(var r=0;r<t[e].length;r++)if(-1==t[e][r])return;this.pause()}},o.setMenuVisible=function(t){this.startMenu&&(this.startMenu.active=t),this.shareBtn&&(this.shareBtn.active=!t),this.shareMenu&&(this.shareMenu.active=!1)},o.checkHelpMode=function(){if("undefined"!=typeof window){var t=new URLSearchParams(window.location.search);if(t.has("b")&&t.has("r")&&t.has("g")&&t.has("o")&&t.has("p")){var e,r,n=parseInt(t.get("b"));if(isNaN(n)||n<E||n>m)return;var i=parseInt(t.get("r"));if(isNaN(i)||i<0||i>1)return;var l=parseInt(t.get("g"));if(isNaN(l)||l<-1||l>1)return;var a=t.get("o");if(!/^\d+$/.test(a)||a.length%2!=0&&"0"!=a)return;for(var o=t.getAll("p"),s=0;s<o.length;s++){var u=o[s];if(!/^\d+$/.test(u)||u.length%2!=0)return}d.setBoardLength(n),d.setBuff(B.BD_ROTATE,i),d.setBuff(B.BD_GRAVITY,l),this.setMenuVisible(!1),this.stageLabel&&(this.stageLabel.string=""),this.screenshotBtn&&(this.screenshotBtn.active=!0);var h=new Set;if("0"!=a)for(var f=0;f<a.length;f+=2){var c=[parseInt(a[f]),parseInt(a[f+1])],p=c[0],g=c[1];h.add(p*n+g)}this.initBoard(h);for(var v=[],z=0;z<o.length;z++){for(var b=o[z],C=[],P=0;P<b.length;P+=2){var y=[parseInt(b[P]),parseInt(b[P+1])],L=y[0],M=y[1];C.push([L,M])}v.push(C)}d.setPuzzles(v),null==(e=this.puzzleCtrl)||e.initPuzzle(),null==(r=this.puzzleCtrl)||r.setEventsActive(!0),this.setEventsActive(!0),d.setHelpMode(!0)}}},o.onShareBtnClick=function(){if(this.shareMenu)if(0==this.shareMenu.active){if(this.shareMenu.active=!0,this.shareEdit){var t="https://youthtion.github.io/cocos_web/puzzle?",e=d.getBoard().map((function(t){return t.slice()}));t+="b="+String(e.length),t+="&r="+String(d.getBuff(B.BD_ROTATE)),t+="&g="+String(d.getBuff(B.BD_GRAVITY));for(var r="",n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)e[n][i]==1/0&&(r+=String(n)+String(i));t+=""==r?"&o=0":"&o="+r;for(var l=d.getPuzzles().map((function(t){return t.map((function(t){return t.slice()}))})),a=0;a<l.length;a++){t+="&p=";for(var o=0;o<l[a].length;o++){var s=l[a][o],u=s[0],h=s[1];t+=String(u)+String(h)}}this.shareEdit.string=t}}else this.shareMenu.active=!1},o.onCopyBtnClick=function(){var t=l(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.shareEdit){t.next=3;break}return t.next=3,navigator.clipboard.writeText(this.shareEdit.string);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e}(z)).prototype,"cellPrefab",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=e(H.prototype,"puzzleCtrl",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(H.prototype,"buffCtrl",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(H.prototype,"startMenu",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(H.prototype,"btnStart",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=e(H.prototype,"titleLabel",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(H.prototype,"stageLabel",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=e(H.prototype,"shareBtn",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(H.prototype,"shareMenu",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(H.prototype,"shareEdit",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(H.prototype,"screenshotBtn",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=H))||O));o._RF.pop()}}}));

System.register("chunks:///_virtual/GameModel.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"3ed4fPz+JtG/7O1tueJ7qje","GameModel",void 0);var n=t("CELL_WIDTH",60),u=(t("FIT_ALLOW",Math.floor(n/4)),t("ADD_NEAR_RATE",[1,1,1,.7,.5,.3]),t("MAX_BOARD_LENGTH",10),t("MIN_BOARD_LENGTH",3)),i=(t("EGameEvents",function(t){return t.GE_ADD_BUFF="onSetBuffFinish",t.GE_PICK_PUZZLE="onPickPuzzle",t.GE_PLACE_PUZZLE="onPlacePuzzle",t}({})),t("EBuffType",function(t){return t[t.BD_SIZE=0]="BD_SIZE",t[t.BD_HUE=1]="BD_HUE",t[t.BD_ROTATE=2]="BD_ROTATE",t[t.BD_OBSTACLE=3]="BD_OBSTACLE",t[t.BD_ONECELL=4]="BD_ONECELL",t[t.BD_GRAVITY=5]="BD_GRAVITY",t[t.BD_MAX=6]="BD_MAX",t}({}))),o=t("CGameModel",function(){function t(){this.boardLength=u,this.stage=1,this.board=[],this.puzzles=[],this.buffData=new Array(i.BD_MAX).fill(0),this.helpMode=!1}var e=t.prototype;return e.addBoardLength=function(){this.boardLength++},e.decreaseBoardLength=function(){this.boardLength--},e.setBoardLength=function(t){this.boardLength=t},e.addStage=function(){this.stage++},e.setStage=function(t){this.stage=t},e.setBoard=function(t){this.board=t.map((function(t){return t.slice()}))},e.setPuzzles=function(t){this.puzzles=t.map((function(t){return t.map((function(t){return t.slice()}))}))},e.addBuff=function(t){this.buffData[t]++},e.decreaseBuff=function(t){this.buffData[t]--},e.removeBuff=function(t){this.buffData[t]=0},e.setBuff=function(t,e){this.buffData[t]=e},e.setHelpMode=function(t){this.helpMode=t},e.getBoardLength=function(){return this.boardLength},e.getStage=function(){return this.stage},e.getBoard=function(){return this.board},e.getPuzzles=function(){return this.puzzles},e.getBuff=function(t){return this.buffData[t]},e.getHelpMode=function(){return this.helpMode},t}());t("GameModel",new o);e._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./BuffController.ts","./GameController.ts","./GameModel.ts","./PuzzleController.ts","./ScreenshotController.ts"],(function(){return{setters:[null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PuzzleController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts"],(function(e){var t,n,o,i,l,r,a,s,u,h,c,f,g,p,z,P,M,d,v,y,T,E;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){l=e.cclegacy,r=e._decorator,a=e.Prefab,s=e.CCFloat,u=e.input,h=e.Input,c=e.Vec3,f=e.UITransform,g=e.Color,p=e.Node,z=e.instantiate,P=e.Sprite,M=e.Component},function(e){d=e.GameModel,v=e.EBuffType,y=e.EGameEvents,T=e.CELL_WIDTH,E=e.FIT_ALLOW}],execute:function(){var C,b,_,m,S,U,L,I,x;l._RF.push({},"4b28053qTlNFqEjoH7O1aS0","PuzzleController",void 0);var A=r.ccclass,O=r.property,w=function(e){return e[e.MT_LEFT=0]="MT_LEFT",e[e.MT_MID=1]="MT_MID",e[e.MT_RIGHT=2]="MT_RIGHT",e}(w||{});e("PuzzleController",(C=A("PuzzleController"),b=O({type:a}),_=O({type:s,min:0,max:1,step:.01}),m=O({type:s,min:0,max:1,step:.01}),C((L=t((U=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return t=e.call.apply(e,[this].concat(l))||this,o(t,"cellPrefab",L,i(t)),o(t,"cellSaturation",I,i(t)),o(t,"cellLightness",x,i(t)),t.fitCells=[],t.placePuzzlePos=[0,0],t.dragPuzzle=null,t.dragStartPos=new c,t.puzzleStartPos=new c,t}n(t,e);var l=t.prototype;return l.start=function(){},l.update=function(e){},l.setEventsActive=function(e){e?(u.on(h.EventType.MOUSE_MOVE,this.onMouseMove,this),u.on(h.EventType.MOUSE_UP,this.onMouseUp,this)):(u.off(h.EventType.MOUSE_MOVE,this.onMouseMove,this),u.off(h.EventType.MOUSE_UP,this.onMouseUp,this))},l.initPuzzle=function(){var e=this;if(this.cellPrefab){var t=d.getBoard(),n=d.getPuzzles().map((function(e){return e.map((function(e){return e.slice()}))})),o=this.generateHueColors(n.length*(d.getBuff(v.BD_HUE)+1));this.node.removeAllChildren();for(var i=function(){for(var i=new p(""+l),r=n[l][0],a=r[0],s=r[1],u=0;u<n[l].length;u++){var f=z(e.cellPrefab);if(f){i.addChild(f);var g=n[l][u],M=g[0],y=g[1];f.setPosition((M-a)*T,(y-s)*T,0);var E=f.getComponent(P);E&&(E.color=o[l]),f.on(h.EventType.MOUSE_DOWN,(function(t){e.onMouseDown(t,i)}),e),f.on(h.EventType.MOUSE_MOVE,e.onMouseMove,e),f.on(h.EventType.MOUSE_UP,e.onMouseUp,e)}}0==d.getBuff(v.BD_ROTATE)&&(i.eulerAngles=new c(i.eulerAngles.x,i.eulerAngles.y,i.eulerAngles.z+90*Math.floor(4*Math.random()))),i.setPosition(t.length*T*-1,0,0),e.node.addChild(i)},l=0;l<n.length;l++)i()}},l.onMouseDown=function(e,t){if(t.parent)if(t.setSiblingIndex(t.parent.children.length-1),this.getFitCell(t),this.fitCells.length==t.children.length&&this.node.emit(y.GE_PICK_PUZZLE,this.fitCells,t.name),0==d.getBuff(v.BD_ROTATE)&&e.getButton()==w.MT_RIGHT){var n=new c(e.getUILocation().x,e.getUILocation().y,0),o=t.parent.getComponent(f).convertToNodeSpaceAR(n),i=t.getPosition(),l=new c(o.x-i.x,o.y-i.y,0),r=[Math.cos(Math.PI/-2),Math.sin(Math.PI/-2)],a=r[0],s=r[1],u=l.x*a-l.y*s,h=l.x*s+l.y*a,g=o.x-u,p=o.y-h;t.setPosition(g,p,0),t.eulerAngles=new c(t.eulerAngles.x,t.eulerAngles.y,(t.eulerAngles.z-90)%360)}else e.getButton()!=w.MT_LEFT||this.dragPuzzle||(this.puzzleStartPos.set(t.getPosition()),this.dragStartPos.set(e.getUILocation().x,e.getUILocation().y,0),this.dragPuzzle=t)},l.onMouseMove=function(e){if(this.dragPuzzle){var t=e.getUILocation(),n=this.dragStartPos.x-t.x,o=this.dragStartPos.y-t.y;this.dragPuzzle.setPosition(this.puzzleStartPos.x-n,this.puzzleStartPos.y-o)}},l.onMouseUp=function(e){if(this.dragPuzzle){if(this.getFitCell(this.dragPuzzle),this.fitCells.length==this.dragPuzzle.children.length)return void this.node.emit(y.GE_PLACE_PUZZLE,this.fitCells,this.dragPuzzle.name);this.dragPuzzle=null}},l.getFitCell=function(e){var t=0,n=0;if(this.fitCells=[],e.parent)for(var o=d.getBoard(),i=0;i<e.children.length;i++){var l=e.children[i].getWorldPosition(),r=e.parent.getComponent(f).convertToNodeSpaceAR(l),a=[r.x,r.y],s=a[0],u=a[1];if(Math.abs(s)>T*(o.length-1)/2+E||Math.abs(u)>T*(o.length-1)/2+E)break;if(o.length%2==0){var h=[s+.5*T,u+.5*T];s=h[0],u=h[1]}if(Math.abs(s%T)>E&&Math.abs(s%T)<T-E)break;if(Math.abs(u%T)>E&&Math.abs(u%T)<T-E)break;if(0==t&&0==n){(t=(s%T+T)%T)>E&&(t-=T),(n=(u%T+T)%T)>E&&(n-=T);var c=e.getPosition();this.placePuzzlePos=[c.x-t,c.y-n]}var g=[s-t,u-n];s=g[0],u=g[1],this.fitCells.push([Math.round(s/T+Math.floor((o.length-1)/2)),Math.round(u/T+Math.floor((o.length-1)/2))])}},l.onPlacePuzzleCallback=function(e){this.dragPuzzle&&null!=e&&(this.dragPuzzle.setPosition(this.placePuzzlePos[0],this.placePuzzlePos[1]-Math.round(e*T),0),this.placePuzzlePos=[0,0]),this.dragPuzzle=null},l.hslToRgb=function(e,t,n){var o,i,l;if(0==t)o=i=l=n;else{var r=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:s},a=n<.5?n*(1+t):n+t-n*t,s=2*n-a;o=r(s,a,e+1/3),i=r(s,a,e),l=r(s,a,e-1/3)}return[255*o,255*i,255*l]},l.generateHueColors=function(e){for(var t=[],n=0;n<e;n++){var o=n/e,i=this.hslToRgb(o,this.cellSaturation,this.cellLightness),l=i[0],r=i[1],a=i[2];t.push(new g(l,r,a))}return t},t}(M)).prototype,"cellPrefab",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(U.prototype,"cellSaturation",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),x=t(U.prototype,"cellLightness",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S=U))||S));l._RF.pop()}}}));

System.register("chunks:///_virtual/ScreenshotController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n,a,o,i,c,l,s,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,a=e.assertThisInitialized,o=e.asyncToGenerator,i=e.regeneratorRuntime},function(e){c=e.cclegacy,l=e._decorator,s=e.Camera,u=e.Component}],execute:function(){var p,h,f,g,m;c._RF.push({},"959e54MyFBP2L9Vu8M7LlBH","ScreenshotController",void 0);var v=l.ccclass,d=l.property;e("ScreenshotController",(p=v("ScreenshotController"),h=d(s),p((m=t((g=function(e){function t(){for(var t,r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=e.call.apply(e,[this].concat(o))||this,n(t,"screenshotCamera",m,a(t)),t}r(t,e);var c=t.prototype;return c.start=function(){},c.update=function(e){},c.onScreenshotClick=function(){var e=this.screenshotCamera.targetTexture;if(e){var t=[e.width,e.height],r=t[0],n=t[1],a=e.readPixels(),o=document.createElement("canvas"),i=[r,n];o.width=i[0],o.height=i[1];for(var c=o.getContext("2d"),l=c.createImageData(r,n),s=0;s<n;s++)for(var u=0;u<r;u++){var p=4*((n-s-1)*r+u),h=4*(s*r+u);l.data.set(a.slice(p,p+4),h)}c.putImageData(l,0,0),o.toBlob(this.toBlobCallBack,"image/png")}},c.toBlobCallBack=function(){var e=o(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,navigator.clipboard.write([new ClipboardItem({"image/png":t})]);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t}(u)).prototype,"screenshotCamera",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=g))||f));c._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});