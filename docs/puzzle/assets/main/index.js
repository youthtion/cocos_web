System.register("chunks:///_virtual/BuffController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts"],(function(t){var e,f,i,u,s,r,n,b,B,a,h,l,_,o,L,T;return{setters:[function(t){e=t.applyDecoratedDescriptor,f=t.inheritsLoose,i=t.initializerDefineProperty,u=t.assertThisInitialized},function(t){s=t.cclegacy,r=t._decorator,n=t.Node,b=t.Label,B=t.Sprite,a=t.CCInteger,h=t.SpriteAtlas,l=t.Component},function(t){_=t.GameModel,o=t.MIN_BOARD_LENGTH,L=t.MAX_BOARD_LENGTH,T=t.ADD_NEAR_RATE}],execute:function(){var p,c,E,S,g,O,R,A,C,U,m,y,z,Z,G,N,P,F,d,v,D,w,H,M,k,Y,I,W,X;s._RF.push({},"efd9cZ2vtdGkZunZzVclwQC","BuffController",void 0);var x=r.ccclass,V=r.property,j=function(t){return t[t.BT_GROW_STOP=0]="BT_GROW_STOP",t[t.BT_GROW_DEC=1]="BT_GROW_DEC",t[t.BT_SMALLER_PUZZLE=2]="BT_SMALLER_PUZZLE",t[t.BT_BIGGER_PUZZLE=3]="BT_BIGGER_PUZZLE",t[t.BT_LESS_HUE=4]="BT_LESS_HUE",t[t.BT_MORE_HUE=5]="BT_MORE_HUE",t[t.BT_ADD_OBSTACLE=6]="BT_ADD_OBSTACLE",t[t.BT_DEC_OBSTACLE=7]="BT_DEC_OBSTACLE",t[t.BT_GET_1X1_PUZZLE=8]="BT_GET_1X1_PUZZLE",t[t.BT_LOSE_1X1_PUZZLE=9]="BT_LOSE_1X1_PUZZLE",t[t.BT_CANNOT_ROTATE=10]="BT_CANNOT_ROTATE",t[t.BT_LESS_BUFF=11]="BT_LESS_BUFF",t[t.BT_MORE_BUFF=12]="BT_MORE_BUFF",t[t.BT_REFRESH=13]="BT_REFRESH",t[t.BT_GRAVITY=14]="BT_GRAVITY",t[t.BT_BUOYANCY=15]="BT_BUOYANCY",t[t.BT_PASS=16]="BT_PASS",t}(j||{});t("BuffController",(p=x("BuffController"),c=V({type:n}),E=V({type:b}),S=V({type:n}),g=V({type:n}),O=V({type:n}),R=V({type:b}),A=V({type:b}),C=V({type:b}),U=V({type:B}),m=V({type:B}),y=V({type:B}),z=V({type:a}),Z=V({type:h}),p((P=e((N=function(t){function e(){for(var e,f=arguments.length,s=new Array(f),r=0;r<f;r++)s[r]=arguments[r];return e=t.call.apply(t,[this].concat(s))||this,i(e,"refreshBtn",P,u(e)),i(e,"freshLabel",F,u(e)),i(e,"buffBtn1",d,u(e)),i(e,"buffBtn2",v,u(e)),i(e,"buffBtn3",D,u(e)),i(e,"buffLabel1",w,u(e)),i(e,"buffLabel2",H,u(e)),i(e,"buffLabel3",M,u(e)),i(e,"buffSprite1",k,u(e)),i(e,"buffSprite2",Y,u(e)),i(e,"buffSprite3",I,u(e)),i(e,"buffSpace",W,u(e)),i(e,"buffAtlas",X,u(e)),e.buffBtns=[],e.buffLabels=[],e.buffSprites=[],e.buffList=[],e.buffNum=2,e.refreshNum=90,e.buffText=["底板不擴大(1場)","底板縮小","小方塊變多","大方塊變多","方塊色差小","方塊色差大","底板缺格增加","底板缺格減少","獲得1x1方塊","失去1x1方塊\n出現底板縮小","不可旋轉(1場)\n出現底板縮小","選項減少\n獲得刷新次數","選項增加","刷新選項","產生重力(1場)","產生浮力(1場)","跳過"],e}f(e,t);var s=e.prototype;return s.start=function(){this.buffBtn1&&this.buffBtns.push(this.buffBtn1),this.buffBtn2&&this.buffBtns.push(this.buffBtn2),this.buffBtn3&&this.buffBtns.push(this.buffBtn3),this.buffLabel1&&this.buffLabels.push(this.buffLabel1),this.buffLabel2&&this.buffLabels.push(this.buffLabel2),this.buffLabel3&&this.buffLabels.push(this.buffLabel3),this.buffSprite1&&this.buffSprites.push(this.buffSprite1),this.buffSprite2&&this.buffSprites.push(this.buffSprite2),this.buffSprite3&&this.buffSprites.push(this.buffSprite3)},s.update=function(t){},s.showBuffBtn=function(){for(var t=0;t<this.buffBtns.length;t++)if(this.buffNum>t){this.buffBtns[t].active=!0,this.buffBtns[t].setPosition(this.buffSpace*(this.buffNum-1)*-.5+t*this.buffSpace,0,0),this.buffLabels[t].string=this.buffText[this.buffList[t]];var e=this.buffList[t]+1;this.buffList[t]==j.BT_LESS_BUFF&&(this.buffNum-1==1?e=12:this.buffNum-1==2&&(e=18)),this.buffList[t]==j.BT_MORE_BUFF&&(this.buffNum+1==2?e=18:this.buffNum+1==3&&(e=13)),this.buffSprites[t].spriteFrame=this.buffAtlas.getSpriteFrame(""+e)}else this.buffBtns[t].active=!1;this.refreshBtn&&(this.refreshBtn.active=this.refreshNum>0,this.freshLabel&&(this.freshLabel.string=""+this.refreshNum))},s.onBuffClick=function(t,e){this.setBuff(e)},s.onRefreshClick=function(){this.refreshNum-=1,this.generateBuffList(),this.showBuffBtn()},s.getBuffAddNearRate=function(){for(var t=T.slice(),e=3;e<t.length;e++)t[e]+=.1*_.getPuzzleSizeBuff(),t[e]>1?t[e]=1:t[e]<0&&(t[e]=0);return t},s.setBuff=function(t){var e=this.buffList[t];switch(e){case j.BT_GROW_STOP:break;case j.BT_GROW_DEC:_.getBoardLength()>o&&_.setBoardLength(_.getBoardLength()-1);break;case j.BT_SMALLER_PUZZLE:_.setPuzzleSizeBuff(_.getPuzzleSizeBuff()-1);break;case j.BT_BIGGER_PUZZLE:_.setPuzzleSizeBuff(_.getPuzzleSizeBuff()+1);break;case j.BT_LESS_HUE:_.setLessHueBuff(_.getLessHueBuff()+1);break;case j.BT_MORE_HUE:_.setLessHueBuff(_.getLessHueBuff()-1);break;case j.BT_ADD_OBSTACLE:_.setObstacleBuff(_.getObstacleBuff()+1);break;case j.BT_DEC_OBSTACLE:_.setObstacleBuff(_.getObstacleBuff()-1);break;case j.BT_GET_1X1_PUZZLE:_.setOnecellBuff(_.getOnecellBuff()+1);break;case j.BT_LOSE_1X1_PUZZLE:return _.setOnecellBuff(_.getOnecellBuff()-1),this.buffList[t]=j.BT_GROW_DEC,void this.showBuffBtn();case j.BT_CANNOT_ROTATE:return _.setCannotRotateBuff(!0),this.buffList[t]=j.BT_GROW_DEC,void this.showBuffBtn();case j.BT_LESS_BUFF:return this.buffNum-=1,this.refreshNum+=1,this.buffList.splice(t,1),void this.showBuffBtn();case j.BT_MORE_BUFF:this.buffNum+=1;var f=[this.buffList[this.buffList.length-1],this.buffList[t]];return this.buffList[t]=f[0],this.buffList[this.buffList.length-1]=f[1],void this.showBuffBtn();case j.BT_REFRESH:return this.generateBuffList(),void this.showBuffBtn();case j.BT_GRAVITY:_.setGravityBuff(1);break;case j.BT_BUOYANCY:_.setGravityBuff(-1);break;case j.BT_PASS:}e>j.BT_GROW_DEC&&_.getBoardLength()<L&&_.setBoardLength(_.getBoardLength()+1),this.node.emit("onSetBuffFinish")},s.generateBuffList=function(){this.buffList=[],_.getBoardLength()<L&&this.buffList.push(j.BT_GROW_STOP),_.getPuzzleSizeBuff()>-3&&this.buffList.push(j.BT_SMALLER_PUZZLE),_.getPuzzleSizeBuff()<3&&this.buffList.push(j.BT_BIGGER_PUZZLE),this.buffList.push(j.BT_LESS_HUE),_.getLessHueBuff()>1&&this.buffList.push(j.BT_MORE_HUE),_.getObstacleBuff()<4&&this.buffList.push(j.BT_ADD_OBSTACLE),_.getObstacleBuff()>0&&this.buffList.push(j.BT_DEC_OBSTACLE),_.getOnecellBuff()<5&&this.buffList.push(j.BT_GET_1X1_PUZZLE),_.getBoardLength()>o&&(_.getOnecellBuff()>0&&this.buffList.push(j.BT_LOSE_1X1_PUZZLE),_.getCannotRotateBuff()||this.buffList.push(j.BT_CANNOT_ROTATE)),this.buffNum>1&&this.buffList.push(j.BT_LESS_BUFF),this.buffNum<3&&this.buffList.push(j.BT_MORE_BUFF),this.buffList.push(j.BT_REFRESH),0==_.getGravityBuff()&&(this.buffList.push(j.BT_GRAVITY),this.buffList.push(j.BT_BUOYANCY)),this.buffList.push(j.BT_PASS);for(var t=0;t<this.buffList.length;t++){var e=Math.floor(Math.random()*(this.buffList.length-t))+t,f=[this.buffList[e],this.buffList[t]];this.buffList[t]=f[0],this.buffList[e]=f[1]}},e}(l)).prototype,"refreshBtn",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(N.prototype,"freshLabel",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=e(N.prototype,"buffBtn1",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(N.prototype,"buffBtn2",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(N.prototype,"buffBtn3",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(N.prototype,"buffLabel1",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(N.prototype,"buffLabel2",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(N.prototype,"buffLabel3",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(N.prototype,"buffSprite1",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=e(N.prototype,"buffSprite2",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(N.prototype,"buffSprite3",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(N.prototype,"buffSpace",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),X=e(N.prototype,"buffAtlas",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=N))||G));s._RF.pop()}}}));

System.register("chunks:///_virtual/GameController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts","./PuzzleController.ts","./BuffController.ts"],(function(t){var e,n,r,i,l,a,o,s,u,h,f,c,g,p,v,z,b,d,C,B,m,y,M,P;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized,l=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){o=t.cclegacy,s=t._decorator,u=t.Prefab,h=t.Node,f=t.Label,c=t.EditBox,g=t.instantiate,p=t.Sprite,v=t.Component},function(t){z=t.GameModel,b=t.CELL_WIDTH,d=t.OBSTACLE_COLOR,C=t.BOARD_COLOR,B=t.ADD_NEAR_RATE,m=t.MIN_BOARD_LENGTH,y=t.MAX_BOARD_LENGTH},function(t){M=t.PuzzleController},function(t){P=t.BuffController}],execute:function(){var L,w,S,R,A,E,N,k,_,G,O,F,I,D,H,T,x,V,$,j,U,W,X,q,J;o._RF.push({},"7e675OHFblFTawCzOgyllbA","GameController",void 0);var K=s.ccclass,Q=s.property;t("GameController",(L=K("GameController"),w=Q({type:u}),S=Q({type:M}),R=Q({type:P}),A=Q({type:h}),E=Q({type:h}),N=Q({type:f}),k=Q({type:f}),_=Q({type:h}),G=Q({type:h}),O=Q({type:c}),F=Q({type:h}),L((H=e((D=function(t){function e(){for(var e,n=arguments.length,l=new Array(n),a=0;a<n;a++)l[a]=arguments[a];return e=t.call.apply(t,[this].concat(l))||this,r(e,"cellPrefab",H,i(e)),r(e,"puzzleCtrl",T,i(e)),r(e,"buffCtrl",x,i(e)),r(e,"startMenu",V,i(e)),r(e,"btnStart",$,i(e)),r(e,"titleLabel",j,i(e)),r(e,"stageLabel",U,i(e)),r(e,"shareBtn",W,i(e)),r(e,"shareMenu",X,i(e)),r(e,"shareEdit",q,i(e)),r(e,"screenshotBtn",J,i(e)),e}n(e,t);var o=e.prototype;return o.start=function(){var t;this.checkHelpMode(),null==(t=this.buffCtrl)||t.node.on("onSetBuffFinish",this.onStartButtonClicked,this)},o.restart=function(){var t,e;this.setMenuVisible(!1),this.stageLabel&&(this.stageLabel.string="Stage"+z.getStage()),this.initBoard(),this.generatePuzzle(),null==(t=this.puzzleCtrl)||t.initPuzzle(),null==(e=this.puzzleCtrl)||e.setEventsActive(!0),this.setEventsActive(!0)},o.pause=function(){var t,e,n;this.setMenuVisible(!0),this.btnStart&&(this.btnStart.active=!1),this.titleLabel&&(this.titleLabel.string=""),this.stageLabel&&(this.stageLabel.string=""),z.setStage(z.getStage()+1),z.setCannotRotateBuff(!1),z.setGravityBuff(0),null==(t=this.buffCtrl)||t.generateBuffList(),null==(e=this.buffCtrl)||e.showBuffBtn(),null==(n=this.puzzleCtrl)||n.setEventsActive(!1),this.setEventsActive(!1)},o.update=function(t){},o.setEventsActive=function(t){var e,n,r,i;t?(null==(e=this.puzzleCtrl)||e.node.on("onFitPuzzle",this.onFitPuzzle,this),null==(n=this.puzzleCtrl)||n.node.on("onRemovePuzzle",this.onRemovePuzzle,this)):(null==(r=this.puzzleCtrl)||r.node.off("onFitPuzzle",this.onFitPuzzle,this),null==(i=this.puzzleCtrl)||i.node.off("onRemovePuzzle",this.onRemovePuzzle,this))},o.initBoard=function(t){if(void 0===t&&(t=new Set),this.cellPrefab){var e=z.getBoardLength(),n=[];if(this.node.removeAllChildren(),0==t.size&&z.getObstacleBuff()>0)for(var r=z.getObstacleBuff(),i=Math.floor(e*e/r),l=0;l<r;l++)t.add(Math.floor(Math.random()*i)+i*l);for(var a=0;a<e;a++){for(var o=[],s=0;s<e;s++){var u=g(this.cellPrefab);if(u){this.node.addChild(u),u.setPosition(a*b,s*b,0);var h=u.getComponent(p);t.size>0&&t.has(a*e+s)?(h&&(h.color=d),o.push(1/0)):(h&&(h.color=C),o.push(-1))}}n.push(o)}z.setBoard(n);var f=e*b*-.5+.5*b;this.node.setPosition(f,f,0)}},o.generatePuzzle=function(){for(var t=z.getBoard().map((function(t){return t.slice()})),e=[],n=z.getOnecellBuff(),r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)if(-1==t[r][i]){var l=e.length;if(e.push([[r,i]]),n>0)t[r][i]=1/0,n--;else if(t[r][i]=l,this.addNearCell(e,t),e[l].length<=1){var a=e[l][0],o=a[0],s=a[1],u=this.findNearPuzzle(t,o,s);e[u].push(e[l][0]),e.pop(),t[o][s]=u}}z.setPuzzles(e)},o.addNearCell=function(t,e){for(var n=t.length-1,r=t[n],i=e.map((function(t){return t.slice()})),l=[],a=[[1,0],[0,1]],o=0;o<r.length;o++)for(var s=r[o],u=s[0],h=s[1],f=0;f<a.length;f++){var c=a[f],g=u+c[0],p=h+c[1];g<i.length&&p<i[g].length&&-1==i[g][p]&&(l.push([g,p]),i[g][p]=0)}if(l.length>0&&r.length<B.length){var v,z=null==(v=this.buffCtrl)?void 0:v.getBuffAddNearRate().slice();if(Math.random()<z[r.length]){var b=Math.floor(Math.random()*l.length),d=l[b],C=d[0],m=d[1];t[n].push(l[b]),e[C][m]=n,this.addNearCell(t,e)}}},o.findNearPuzzle=function(t,e,n){for(var r=[[-1,0],[1,0],[0,1],[0,-1]],i=[],l=0;l<r.length;l++){var a=r[l],o=e+a[0],s=n+a[1];o>=0&&s>=0&&o<t.length&&s<t[o].length&&t[o][s]>-1&&t[o][s]!=1/0&&i.push([o,s])}if(i.length>0){var u=i[Math.floor(Math.random()*i.length)],h=u[0],f=u[1];return t[h][f]}return 0},o.onFitPuzzle=function(t,e){for(var n,r=z.getGravityBuff(),i=1/0,l=-1,a=0;a<t.length;a++)t[a][1]<i&&(i=t[a][1]),t[a][1]>l&&(l=t[a][1]);var o=z.getBoard().map((function(t){return t.slice()})),s=null,u=0;r>0?u=i-0:r<0&&(u=o.length-1-l);for(var h=0;h<=u;h++){for(var f=0,c=0;c<t.length;c++){var g=t[c],p=g[0],v=g[1];if(-1!=o[p][v-h*r])break;f++}if(f!=t.length)break;s=h*r}if(null!=s){for(var b=parseInt(e),d=0;d<t.length;d++){var C=t[d],B=C[0],m=C[1];o[B][m-s]=b}z.setBoard(o),null==(n=this.puzzleCtrl)||n.onFitPuzzleCallback(s),this.checkResult(o)}else{var y;null==(y=this.puzzleCtrl)||y.onFitPuzzleCallback(s)}},o.onRemovePuzzle=function(t,e){for(var n=parseInt(e),r=z.getBoard().map((function(t){return t.slice()})),i=0;i<t.length;i++){var l=t[i],a=l[0],o=l[1];if(r[a][o]!=n)return;r[a][o]=-1}z.setBoard(r)},o.onStartButtonClicked=function(){this.restart()},o.checkResult=function(t){if(!z.getHelpMode()){for(var e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++)if(-1==t[e][n])return;this.pause()}},o.setMenuVisible=function(t){this.startMenu&&(this.startMenu.active=t),this.shareBtn&&(this.shareBtn.active=!t),this.shareMenu&&(this.shareMenu.active=!1)},o.checkHelpMode=function(){if("undefined"!=typeof window){var t=new URLSearchParams(window.location.search);if(t.has("b")&&t.has("r")&&t.has("g")&&t.has("o")&&t.has("p")){var e,n,r=parseInt(t.get("b"));if(isNaN(r)||r<m||r>y)return;var i=parseInt(t.get("r"));if(isNaN(i)||i<0||i>1)return;var l=parseInt(t.get("g"));if(isNaN(l)||l<-1||l>1)return;var a=t.get("o");if(!/^\d+$/.test(a)||a.length%2!=0&&"0"!=a)return;for(var o=t.getAll("p"),s=0;s<o.length;s++){var u=o[s];if(!/^\d+$/.test(u)||u.length%2!=0)return}z.setBoardLength(r),z.setCannotRotateBuff(0==i),z.setGravityBuff(l),this.setMenuVisible(!1),this.stageLabel&&(this.stageLabel.string=""),this.screenshotBtn&&(this.screenshotBtn.active=!0);var h=new Set;if("0"!=a)for(var f=0;f<a.length;f+=2){var c=[parseInt(a[f]),parseInt(a[f+1])],g=c[0],p=c[1];h.add(g*r+p)}this.initBoard(h);for(var v=[],b=0;b<o.length;b++){for(var d=o[b],C=[],B=0;B<d.length;B+=2){var M=[parseInt(d[B]),parseInt(d[B+1])],P=M[0],L=M[1];C.push([P,L])}v.push(C)}z.setPuzzles(v),null==(e=this.puzzleCtrl)||e.initPuzzle(),null==(n=this.puzzleCtrl)||n.setEventsActive(!0),this.setEventsActive(!0),z.setHelpMode(!0)}}},o.onShareBtnClick=function(){if(this.shareMenu)if(0==this.shareMenu.active){if(this.shareMenu.active=!0,this.shareEdit){var t="https://youthtion.github.io/cocos_web/puzzle?",e=z.getBoard().map((function(t){return t.slice()}));t+="b="+String(e.length),t+="&r="+String(1==z.getCannotRotateBuff()?0:1),t+="&g="+String(z.getGravityBuff());for(var n="",r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)e[r][i]==1/0&&(n+=String(r)+String(i));t+=""==n?"&o=0":"&o="+n;for(var l=z.getPuzzles().map((function(t){return t.map((function(t){return t.slice()}))})),a=0;a<l.length;a++){t+="&p=";for(var o=0;o<l[a].length;o++){var s=l[a][o],u=s[0],h=s[1];t+=String(u)+String(h)}}this.shareEdit.string=t}}else this.shareMenu.active=!1},o.onCopyBtnClick=function(){var t=l(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.shareEdit){t.next=3;break}return t.next=3,navigator.clipboard.writeText(this.shareEdit.string);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e}(v)).prototype,"cellPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(D.prototype,"puzzleCtrl",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(D.prototype,"buffCtrl",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(D.prototype,"startMenu",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=e(D.prototype,"btnStart",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(D.prototype,"titleLabel",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(D.prototype,"stageLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(D.prototype,"shareBtn",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(D.prototype,"shareMenu",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(D.prototype,"shareEdit",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=e(D.prototype,"screenshotBtn",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=D))||I));o._RF.pop()}}}));

System.register("chunks:///_virtual/GameModel.ts",["cc"],(function(t){var e,n;return{setters:[function(t){e=t.cclegacy,n=t.Color}],execute:function(){e._RF.push({},"3ed4fPz+JtG/7O1tueJ7qje","GameModel",void 0);var u=t("CELL_WIDTH",60),f=(t("FIT_ALLOW",Math.floor(u/4)),t("BOARD_COLOR",new n(64,64,64)),t("OBSTACLE_COLOR",new n(0,0,0)),t("ADD_NEAR_RATE",[1,1,1,.7,.5,.3]),t("MAX_BOARD_LENGTH",10),t("MIN_BOARD_LENGTH",3)),i=t("CGameModel",function(){function t(){this.boardLength=f,this.stage=1,this.board=[],this.puzzles=[],this.puzzleSizeBuff=0,this.lessHueBuff=1,this.cannotRotateBuff=!1,this.obstacleBuff=0,this.onecellBuff=0,this.gravityBuff=0,this.helpMode=!1}var e=t.prototype;return e.setBoardLength=function(t){this.boardLength=t},e.setStage=function(t){this.stage=t},e.setBoard=function(t){this.board=t.map((function(t){return t.slice()}))},e.setPuzzles=function(t){this.puzzles=t.map((function(t){return t.map((function(t){return t.slice()}))}))},e.setPuzzleSizeBuff=function(t){this.puzzleSizeBuff=t},e.setLessHueBuff=function(t){this.lessHueBuff=t},e.setCannotRotateBuff=function(t){this.cannotRotateBuff=t},e.setObstacleBuff=function(t){this.obstacleBuff=t},e.setOnecellBuff=function(t){this.onecellBuff=t},e.setGravityBuff=function(t){this.gravityBuff=t},e.setHelpMode=function(t){this.helpMode=t},e.getBoardLength=function(){return this.boardLength},e.getStage=function(){return this.stage},e.getBoard=function(){return this.board},e.getPuzzles=function(){return this.puzzles},e.getPuzzleSizeBuff=function(){return this.puzzleSizeBuff},e.getLessHueBuff=function(){return this.lessHueBuff},e.getCannotRotateBuff=function(){return this.cannotRotateBuff},e.getObstacleBuff=function(){return this.obstacleBuff},e.getOnecellBuff=function(){return this.onecellBuff},e.getGravityBuff=function(){return this.gravityBuff},e.getHelpMode=function(){return this.helpMode},t}());t("GameModel",new i);e._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./BuffController.ts","./GameController.ts","./GameModel.ts","./PuzzleController.ts","./ScreenshotController.ts"],(function(){return{setters:[null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PuzzleController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts"],(function(e){var t,n,o,i,l,r,s,a,u,h,f,g,c,z,P,p,M,d,v,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){l=e.cclegacy,r=e._decorator,s=e.Prefab,a=e.CCFloat,u=e.input,h=e.Input,f=e.Vec3,g=e.UITransform,c=e.Color,z=e.Node,P=e.instantiate,p=e.Sprite,M=e.Component},function(e){d=e.GameModel,v=e.CELL_WIDTH,y=e.FIT_ALLOW}],execute:function(){var C,T,b,m,S,E,_,U,x;l._RF.push({},"4b28053qTlNFqEjoH7O1aS0","PuzzleController",void 0);var I=r.ccclass,L=r.property,w=function(e){return e[e.MT_LEFT=0]="MT_LEFT",e[e.MT_MID=1]="MT_MID",e[e.MT_RIGHT=2]="MT_RIGHT",e}(w||{});e("PuzzleController",(C=I("PuzzleController"),T=L({type:s}),b=L({type:a,min:0,max:1,step:.01}),m=L({type:a,min:0,max:1,step:.01}),C((_=t((E=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return t=e.call.apply(e,[this].concat(l))||this,o(t,"cellPrefab",_,i(t)),o(t,"cellSaturation",U,i(t)),o(t,"cellLightness",x,i(t)),t.fitCells=[],t.fitPuzzlePos=[0,0],t.dragPuzzle=null,t.dragStartPos=new f,t.puzzleStartPos=new f,t}n(t,e);var l=t.prototype;return l.start=function(){},l.update=function(e){},l.setEventsActive=function(e){e?(u.on(h.EventType.MOUSE_MOVE,this.onMouseMove,this),u.on(h.EventType.MOUSE_UP,this.onMouseUp,this)):(u.off(h.EventType.MOUSE_MOVE,this.onMouseMove,this),u.off(h.EventType.MOUSE_UP,this.onMouseUp,this))},l.initPuzzle=function(){var e=this;if(this.cellPrefab){var t=d.getBoard(),n=d.getPuzzles().map((function(e){return e.map((function(e){return e.slice()}))})),o=this.generateHueColors(n.length*d.getLessHueBuff());this.node.removeAllChildren();for(var i=function(){for(var i=new z(""+l),r=n[l][0],s=r[0],a=r[1],u=0;u<n[l].length;u++){var g=P(e.cellPrefab);if(g){i.addChild(g);var c=n[l][u],M=c[0],y=c[1];g.setPosition((M-s)*v,(y-a)*v,0);var C=g.getComponent(p);C&&(C.color=o[l]),g.on(h.EventType.MOUSE_DOWN,(function(t){e.onMouseDown(t,i)}),e),g.on(h.EventType.MOUSE_MOVE,e.onMouseMove,e),g.on(h.EventType.MOUSE_UP,e.onMouseUp,e)}}d.getCannotRotateBuff()||(i.eulerAngles=new f(i.eulerAngles.x,i.eulerAngles.y,i.eulerAngles.z+90*Math.floor(4*Math.random()))),i.setPosition(t.length*v*-1,0,0),e.node.addChild(i)},l=0;l<n.length;l++)i()}},l.onMouseDown=function(e,t){if(t.parent)if(t.setSiblingIndex(t.parent.children.length-1),this.getFitCell(t),this.fitCells.length==t.children.length&&this.node.emit("onRemovePuzzle",this.fitCells,t.name),d.getCannotRotateBuff()||e.getButton()!=w.MT_RIGHT)e.getButton()!=w.MT_LEFT||this.dragPuzzle||(this.puzzleStartPos.set(t.getPosition()),this.dragStartPos.set(e.getUILocation().x,e.getUILocation().y,0),this.dragPuzzle=t);else{var n=new f(e.getUILocation().x,e.getUILocation().y,0),o=t.parent.getComponent(g).convertToNodeSpaceAR(n),i=t.getPosition(),l=new f(o.x-i.x,o.y-i.y,0),r=[Math.cos(Math.PI/-2),Math.sin(Math.PI/-2)],s=r[0],a=r[1],u=l.x*s-l.y*a,h=l.x*a+l.y*s,c=o.x-u,z=o.y-h;t.setPosition(c,z,0),t.eulerAngles=new f(t.eulerAngles.x,t.eulerAngles.y,(t.eulerAngles.z-90)%360)}},l.onMouseMove=function(e){if(this.dragPuzzle){var t=e.getUILocation(),n=this.dragStartPos.x-t.x,o=this.dragStartPos.y-t.y;this.dragPuzzle.setPosition(this.puzzleStartPos.x-n,this.puzzleStartPos.y-o)}},l.onMouseUp=function(e){if(this.dragPuzzle){if(this.getFitCell(this.dragPuzzle),this.fitCells.length==this.dragPuzzle.children.length)return void this.node.emit("onFitPuzzle",this.fitCells,this.dragPuzzle.name);this.dragPuzzle=null}},l.getFitCell=function(e){var t=0,n=0;if(this.fitCells=[],e.parent)for(var o=d.getBoard(),i=0;i<e.children.length;i++){var l=e.children[i].getWorldPosition(),r=e.parent.getComponent(g).convertToNodeSpaceAR(l),s=[r.x,r.y],a=s[0],u=s[1];if(Math.abs(a)>v*(o.length-1)/2+y||Math.abs(u)>v*(o.length-1)/2+y)break;if(o.length%2==0){var h=[a+.5*v,u+.5*v];a=h[0],u=h[1]}if(Math.abs(a%v)>y&&Math.abs(a%v)<v-y)break;if(Math.abs(u%v)>y&&Math.abs(u%v)<v-y)break;if(0==t&&0==n){(t=(a%v+v)%v)>y&&(t-=v),(n=(u%v+v)%v)>y&&(n-=v);var f=e.getPosition();this.fitPuzzlePos=[f.x-t,f.y-n]}var c=[a-t,u-n];a=c[0],u=c[1],this.fitCells.push([Math.round(a/v+Math.floor((o.length-1)/2)),Math.round(u/v+Math.floor((o.length-1)/2))])}},l.onFitPuzzleCallback=function(e){this.dragPuzzle&&null!=e&&(this.dragPuzzle.setPosition(this.fitPuzzlePos[0],this.fitPuzzlePos[1]-Math.round(e*v),0),this.fitPuzzlePos=[0,0]),this.dragPuzzle=null},l.hslToRgb=function(e,t,n){var o,i,l;if(0==t)o=i=l=n;else{var r=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:a},s=n<.5?n*(1+t):n+t-n*t,a=2*n-s;o=r(a,s,e+1/3),i=r(a,s,e),l=r(a,s,e-1/3)}return[255*o,255*i,255*l]},l.generateHueColors=function(e){for(var t=[],n=0;n<e;n++){var o=n/e,i=this.hslToRgb(o,this.cellSaturation,this.cellLightness),l=i[0],r=i[1],s=i[2];t.push(new c(l,r,s))}return t},t}(M)).prototype,"cellPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(E.prototype,"cellSaturation",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),x=t(E.prototype,"cellLightness",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S=E))||S));l._RF.pop()}}}));

System.register("chunks:///_virtual/ScreenshotController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n,a,o,i,c,l,s,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,a=e.assertThisInitialized,o=e.asyncToGenerator,i=e.regeneratorRuntime},function(e){c=e.cclegacy,l=e._decorator,s=e.Camera,u=e.Component}],execute:function(){var p,h,f,g,m;c._RF.push({},"959e54MyFBP2L9Vu8M7LlBH","ScreenshotController",void 0);var v=l.ccclass,d=l.property;e("ScreenshotController",(p=v("ScreenshotController"),h=d(s),p((m=t((g=function(e){function t(){for(var t,r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=e.call.apply(e,[this].concat(o))||this,n(t,"screenshotCamera",m,a(t)),t}r(t,e);var c=t.prototype;return c.start=function(){},c.update=function(e){},c.onScreenshotClick=function(){var e=this.screenshotCamera.targetTexture;if(e){var t=[e.width,e.height],r=t[0],n=t[1],a=e.readPixels(),o=document.createElement("canvas"),i=[r,n];o.width=i[0],o.height=i[1];for(var c=o.getContext("2d"),l=c.createImageData(r,n),s=0;s<n;s++)for(var u=0;u<r;u++){var p=4*((n-s-1)*r+u),h=4*(s*r+u);l.data.set(a.slice(p,p+4),h)}c.putImageData(l,0,0),o.toBlob(this.toBlobCallBack,"image/png")}},c.toBlobCallBack=function(){var e=o(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,navigator.clipboard.write([new ClipboardItem({"image/png":t})]);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t}(u)).prototype,"screenshotCamera",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=g))||f));c._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});