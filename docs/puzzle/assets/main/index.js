System.register("chunks:///_virtual/BuffController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts"],(function(t){var f,e,i,u,s,B,r,_,n,b,h,a,U,E,L,l,o,p;return{setters:[function(t){f=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,u=t.assertThisInitialized},function(t){s=t.cclegacy,B=t._decorator,r=t.Node,_=t.Label,n=t.Sprite,b=t.CCInteger,h=t.SpriteAtlas,a=t.Component},function(t){U=t.GameModel,E=t.EBuffType,L=t.MIN_BOARD_LENGTH,l=t.MAX_BOARD_LENGTH,o=t.EGameEvents,p=t.ADD_NEAR_RATE}],execute:function(){var S,c,O,R,A,T,F,D,g,C,Z,N,d,G,m,y,P,v,H,w,M,I,Y,z,W,k,X,V,x,j;s._RF.push({},"efd9cZ2vtdGkZunZzVclwQC","BuffController",void 0);var Q=B.ccclass,q=B.property,J=function(t){return t[t.BU_GROW_STOP=0]="BU_GROW_STOP",t[t.BU_GROW_DEC=1]="BU_GROW_DEC",t[t.BU_SMALLER_PUZZLE=2]="BU_SMALLER_PUZZLE",t[t.BU_BIGGER_PUZZLE=3]="BU_BIGGER_PUZZLE",t[t.BU_LESS_HUE=4]="BU_LESS_HUE",t[t.BU_MORE_HUE=5]="BU_MORE_HUE",t[t.BU_ADD_OBSTACLE=6]="BU_ADD_OBSTACLE",t[t.BU_DEC_OBSTACLE=7]="BU_DEC_OBSTACLE",t[t.BU_GET_1X1_PUZZLE=8]="BU_GET_1X1_PUZZLE",t[t.BU_LOSE_1X1_PUZZLE=9]="BU_LOSE_1X1_PUZZLE",t[t.BU_CANNOT_ROTATE=10]="BU_CANNOT_ROTATE",t[t.BU_LESS_BUFF=11]="BU_LESS_BUFF",t[t.BU_BUFF_START=11]="BU_BUFF_START",t[t.BU_ONE_BUFF=12]="BU_ONE_BUFF",t[t.BU_TWO_BUFF=13]="BU_TWO_BUFF",t[t.BU_THREE_BUFF=14]="BU_THREE_BUFF",t[t.BU_MORE_BUFF=15]="BU_MORE_BUFF",t[t.BU_REFRESH=16]="BU_REFRESH",t[t.BU_GRAVITY=17]="BU_GRAVITY",t[t.BU_BUOYANCY=18]="BU_BUOYANCY",t[t.BU_PASS=19]="BU_PASS",t}(J||{}),K=((S={})[J.BU_GROW_STOP]="底板不擴大(1場)",S[J.BU_GROW_DEC]="底板縮小",S[J.BU_SMALLER_PUZZLE]="小方塊變多",S[J.BU_BIGGER_PUZZLE]="大方塊變多",S[J.BU_LESS_HUE]="方塊色差小",S[J.BU_MORE_HUE]="方塊色差大",S[J.BU_ADD_OBSTACLE]="底板缺格增加",S[J.BU_DEC_OBSTACLE]="底板缺格減少",S[J.BU_GET_1X1_PUZZLE]="獲得1x1方塊",S[J.BU_LOSE_1X1_PUZZLE]="失去1x1方塊\n出現底板縮小",S[J.BU_CANNOT_ROTATE]="不可旋轉(1場)\n出現底板縮小",S[J.BU_LESS_BUFF]="選項減少\n獲得刷新次數",S[J.BU_ONE_BUFF]="",S[J.BU_TWO_BUFF]="",S[J.BU_THREE_BUFF]="",S[J.BU_MORE_BUFF]="選項增加",S[J.BU_REFRESH]="刷新選項",S[J.BU_GRAVITY]="產生重力(1場)",S[J.BU_BUOYANCY]="產生浮力(1場)",S[J.BU_PASS]="跳過",S);t("BuffController",(c=Q("BuffController"),O=q({type:r}),R=q({type:_}),A=q({type:r}),T=q({type:r}),F=q({type:r}),D=q({type:_}),g=q({type:_}),C=q({type:_}),Z=q({type:n}),N=q({type:n}),d=q({type:n}),G=q({type:b}),m=q({type:h}),c((v=f((P=function(t){function f(){for(var f,e=arguments.length,s=new Array(e),B=0;B<e;B++)s[B]=arguments[B];return f=t.call.apply(t,[this].concat(s))||this,i(f,"refreshBtn",v,u(f)),i(f,"freshLabel",H,u(f)),i(f,"buffBtn1",w,u(f)),i(f,"buffBtn2",M,u(f)),i(f,"buffBtn3",I,u(f)),i(f,"buffLabel1",Y,u(f)),i(f,"buffLabel2",z,u(f)),i(f,"buffLabel3",W,u(f)),i(f,"buffSprite1",k,u(f)),i(f,"buffSprite2",X,u(f)),i(f,"buffSprite3",V,u(f)),i(f,"buffSpace",x,u(f)),i(f,"buffAtlas",j,u(f)),f.buffBtns=[],f.buffLabels=[],f.buffSprites=[],f.buffList=[],f.buffNum=2,f.refreshNum=0,f}e(f,t);var s=f.prototype;return s.start=function(){this.buffBtn1&&this.buffBtns.push(this.buffBtn1),this.buffBtn2&&this.buffBtns.push(this.buffBtn2),this.buffBtn3&&this.buffBtns.push(this.buffBtn3),this.buffLabel1&&this.buffLabels.push(this.buffLabel1),this.buffLabel2&&this.buffLabels.push(this.buffLabel2),this.buffLabel3&&this.buffLabels.push(this.buffLabel3),this.buffSprite1&&this.buffSprites.push(this.buffSprite1),this.buffSprite2&&this.buffSprites.push(this.buffSprite2),this.buffSprite3&&this.buffSprites.push(this.buffSprite3)},s.update=function(t){},s.showBuffBtn=function(){for(var t=0;t<this.buffBtns.length;t++)if(this.buffNum>t){this.buffBtns[t].active=!0,this.buffBtns[t].setPosition(this.buffSpace*(this.buffNum-1)*-.5+t*this.buffSpace,0,0),this.buffLabels[t].string=K[this.buffList[t]];var f=this.buffList[t];this.buffList[t]==J.BU_LESS_BUFF?f=J.BU_BUFF_START+(this.buffNum-1):this.buffList[t]==J.BU_MORE_BUFF&&(f=J.BU_BUFF_START+(this.buffNum+1)),this.buffSprites[t].spriteFrame=this.buffAtlas.getSpriteFrame(""+f)}else this.buffBtns[t].active=!1;this.refreshBtn&&(this.refreshBtn.active=this.refreshNum>0,this.freshLabel&&(this.freshLabel.string=""+this.refreshNum))},s.onBuffClick=function(t,f){this.setBuff(f)},s.onRefreshClick=function(){this.refreshNum-=1,this.generateBuffList(),this.showBuffBtn()},s.getBuffAddNearRate=function(){for(var t=p.slice(),f=3;f<t.length;f++)t[f]+=.1*U.getBuff(E.BD_SIZE),t[f]>1?t[f]=1:t[f]<0&&(t[f]=0);return t},s.setBuff=function(t){var f=this.buffList[t];switch(f){case J.BU_GROW_DEC:U.getBoardLength()>L&&U.decreaseBoardLength();break;case J.BU_SMALLER_PUZZLE:U.decreaseBuff(E.BD_SIZE);break;case J.BU_BIGGER_PUZZLE:U.addBuff(E.BD_SIZE);break;case J.BU_LESS_HUE:U.addBuff(E.BD_HUE);break;case J.BU_MORE_HUE:U.decreaseBuff(E.BD_HUE);break;case J.BU_ADD_OBSTACLE:U.addBuff(E.BD_OBSTACLE);break;case J.BU_DEC_OBSTACLE:U.decreaseBuff(E.BD_OBSTACLE);break;case J.BU_GET_1X1_PUZZLE:U.addBuff(E.BD_ONECELL);break;case J.BU_LOSE_1X1_PUZZLE:return U.decreaseBuff(E.BD_ONECELL),this.buffList[t]=J.BU_GROW_DEC,void this.showBuffBtn();case J.BU_CANNOT_ROTATE:return U.setBuff(E.BD_ROTATE,1),this.buffList[t]=J.BU_GROW_DEC,void this.showBuffBtn();case J.BU_LESS_BUFF:return this.buffNum-=1,this.refreshNum+=1,this.buffList.splice(t,1),void this.showBuffBtn();case J.BU_MORE_BUFF:this.buffNum+=1;var e=[this.buffList[this.buffList.length-1],this.buffList[t]];return this.buffList[t]=e[0],this.buffList[this.buffList.length-1]=e[1],void this.showBuffBtn();case J.BU_REFRESH:return this.generateBuffList(),void this.showBuffBtn();case J.BU_GRAVITY:U.setBuff(E.BD_GRAVITY,1);break;case J.BU_BUOYANCY:U.setBuff(E.BD_GRAVITY,-1)}f>J.BU_GROW_DEC&&U.getBoardLength()<l&&U.addBoardLength(),this.node.emit(o.GE_ADD_BUFF)},s.generateBuffList=function(){this.buffList=[],U.getBoardLength()<l&&this.buffList.push(J.BU_GROW_STOP),U.getBuff(E.BD_SIZE)>-3&&this.buffList.push(J.BU_SMALLER_PUZZLE),U.getBuff(E.BD_SIZE)<3&&this.buffList.push(J.BU_BIGGER_PUZZLE),this.buffList.push(J.BU_LESS_HUE),U.getBuff(E.BD_HUE)>0&&this.buffList.push(J.BU_MORE_HUE),U.getBuff(E.BD_OBSTACLE)<4&&this.buffList.push(J.BU_ADD_OBSTACLE),U.getBuff(E.BD_OBSTACLE)>0&&this.buffList.push(J.BU_DEC_OBSTACLE),U.getBuff(E.BD_ONECELL)<5&&this.buffList.push(J.BU_GET_1X1_PUZZLE),U.getBoardLength()>L&&(U.getBuff(E.BD_ONECELL)>0&&this.buffList.push(J.BU_LOSE_1X1_PUZZLE),0==U.getBuff(E.BD_ROTATE)&&this.buffList.push(J.BU_CANNOT_ROTATE)),this.buffNum>1&&this.buffList.push(J.BU_LESS_BUFF),this.buffNum<3&&this.buffList.push(J.BU_MORE_BUFF),this.buffList.push(J.BU_REFRESH),0==U.getBuff(E.BD_GRAVITY)&&(this.buffList.push(J.BU_GRAVITY),this.buffList.push(J.BU_BUOYANCY)),this.buffList.push(J.BU_PASS);for(var t=0;t<this.buffList.length;t++){var f=Math.floor(Math.random()*(this.buffList.length-t))+t,e=[this.buffList[f],this.buffList[t]];this.buffList[t]=e[0],this.buffList[f]=e[1]}},f}(a)).prototype,"refreshBtn",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=f(P.prototype,"freshLabel",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=f(P.prototype,"buffBtn1",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=f(P.prototype,"buffBtn2",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=f(P.prototype,"buffBtn3",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=f(P.prototype,"buffLabel1",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=f(P.prototype,"buffLabel2",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=f(P.prototype,"buffLabel3",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=f(P.prototype,"buffSprite1",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=f(P.prototype,"buffSprite2",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=f(P.prototype,"buffSprite3",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=f(P.prototype,"buffSpace",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),j=f(P.prototype,"buffAtlas",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=P))||y));s._RF.pop()}}}));

System.register("chunks:///_virtual/GameController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts","./PuzzleController.ts","./BuffController.ts","./PreloadController.ts"],(function(e){var t,n,r,l,i,a,o,u,s,h,f,c,p,g,b,z,d,v,C,B,P,E,m,y,S;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,l=e.assertThisInitialized,i=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){o=e.cclegacy,u=e._decorator,s=e.Color,h=e.Prefab,f=e.Node,c=e.Label,p=e.EditBox,g=e.instantiate,b=e.Sprite,z=e.Component},function(e){d=e.EGameEvents,v=e.EGameState,C=e.GameModel,B=e.EBuffType,P=e.CELL_WIDTH,E=e.ADD_NEAR_RATE},function(e){m=e.PuzzleController},function(e){y=e.BuffController},function(e){S=e.PreloadController}],execute:function(){var _,G,L,M,A,w,T,k,D,R,F,N,U,H,I,Z,O,x,V,Q,K,Y,j,W,q,J,X;o._RF.push({},"7e675OHFblFTawCzOgyllbA","GameController",void 0);var $=u.ccclass,ee=u.property,te=new s(64,64,64),ne=new s(0,0,0);e("GameController",(_=$("GameController"),G=ee({type:h}),L=ee({type:m}),M=ee({type:y}),A=ee({type:S}),w=ee({type:f}),T=ee({type:f}),k=ee({type:c}),D=ee({type:c}),R=ee({type:f}),F=ee({type:f}),N=ee({type:p}),U=ee({type:f}),_((Z=t((I=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,r(t,"cellPrefab",Z,l(t)),r(t,"puzzleCtrl",O,l(t)),r(t,"buffCtrl",x,l(t)),r(t,"proloadCtrl",V,l(t)),r(t,"buffMenu",Q,l(t)),r(t,"btnStart",K,l(t)),r(t,"titleLabel",Y,l(t)),r(t,"stageLabel",j,l(t)),r(t,"shareBtn",W,l(t)),r(t,"shareMenu",q,l(t)),r(t,"shareEdit",J,l(t)),r(t,"screenshotBtn",X,l(t)),t}n(t,e);var o=t.prototype;return o.start=function(){var e,t;null==(e=this.proloadCtrl)||e.node.on(d.GE_PRELOADED,this.onPreloadData,this),null==(t=this.buffCtrl)||t.node.on(d.GE_ADD_BUFF,this.onStartButtonClicked,this)},o.changeGameState=function(e){var t,n,r,l,i,a,o,u,s;switch(e){case v.GS_BUFF:C.addStage(),C.removeBuff(B.BD_ROTATE),C.removeBuff(B.BD_GRAVITY),null==(t=this.buffCtrl)||t.generateBuffList(),null==(n=this.buffCtrl)||n.showBuffBtn(),null==(r=this.puzzleCtrl)||r.setEventsActive(!1),this.setEventsActive(!1);break;case v.GS_START:this.initBoard(),this.generatePuzzle(),null==(l=this.puzzleCtrl)||l.initPuzzle(),null==(i=this.puzzleCtrl)||i.setEventsActive(!0),null==(a=this.proloadCtrl)||a.setQueryString(),this.setEventsActive(!0);break;case v.GS_HELP:null==(o=this.puzzleCtrl)||o.initPuzzle(),null==(u=this.puzzleCtrl)||u.setEventsActive(!0),null==(s=this.proloadCtrl)||s.setQueryString(),this.setEventsActive(!0),C.setHelpMode(!0)}this.setMenuVisible(e)},o.update=function(e){},o.setEventsActive=function(e){var t,n,r,l;e?(null==(t=this.puzzleCtrl)||t.node.on(d.GE_PLACE_PUZZLE,this.onPlacePuzzle,this),null==(n=this.puzzleCtrl)||n.node.on(d.GE_PICK_PUZZLE,this.onPickPuzzle,this)):(null==(r=this.puzzleCtrl)||r.node.off(d.GE_PLACE_PUZZLE,this.onPlacePuzzle,this),null==(l=this.puzzleCtrl)||l.node.off(d.GE_PICK_PUZZLE,this.onPickPuzzle,this))},o.initBoard=function(e){if(void 0===e&&(e=new Set),this.cellPrefab){var t=C.getBoardLength(),n=[];if(this.node.removeAllChildren(),0==e.size&&C.getBuff(B.BD_OBSTACLE)>0)for(var r=C.getBuff(B.BD_OBSTACLE),l=Math.floor(t*t/r),i=0;i<r;i++)e.add(Math.floor(Math.random()*l)+l*i);for(var a=0;a<t;a++){for(var o=[],u=0;u<t;u++){var s=g(this.cellPrefab);if(s){this.node.addChild(s),s.setPosition(a*P,u*P,0);var h=s.getComponent(b);e.size>0&&e.has(a*t+u)?(h&&(h.color=ne),o.push(1/0)):(h&&(h.color=te),o.push(-1))}}n.push(o)}C.setBoard(n);var f=t*P*-.5+.5*P;this.node.setPosition(f,f,0)}},o.generatePuzzle=function(){for(var e=C.getBoard().map((function(e){return e.slice()})),t=[],n=C.getBuff(B.BD_ONECELL),r=0;r<e.length;r++)for(var l=0;l<e[r].length;l++)if(-1==e[r][l]){var i=t.length;if(t.push([[r,l]]),n>0)e[r][l]=1/0,n--;else if(e[r][l]=i,this.addNearCell(t,e),t[i].length<=1){var a=t[i][0],o=a[0],u=a[1],s=this.findNearPuzzle(e,o,u);t[s].push(t[i][0]),t.pop(),e[o][u]=s}}C.setPuzzles(t)},o.addNearCell=function(e,t){for(var n=e.length-1,r=e[n],l=t.map((function(e){return e.slice()})),i=[],a=[[1,0],[0,1]],o=0;o<r.length;o++)for(var u=r[o],s=u[0],h=u[1],f=0;f<a.length;f++){var c=a[f],p=s+c[0],g=h+c[1];p<l.length&&g<l[p].length&&-1==l[p][g]&&(i.push([p,g]),l[p][g]=0)}if(i.length>0&&r.length<E.length){var b,z=null==(b=this.buffCtrl)?void 0:b.getBuffAddNearRate().slice();if(Math.random()<z[r.length]){var d=Math.floor(Math.random()*i.length),v=i[d],C=v[0],B=v[1];e[n].push(i[d]),t[C][B]=n,this.addNearCell(e,t)}}},o.findNearPuzzle=function(e,t,n){for(var r=[[-1,0],[1,0],[0,1],[0,-1]],l=[],i=0;i<r.length;i++){var a=r[i],o=t+a[0],u=n+a[1];o>=0&&u>=0&&o<e.length&&u<e[o].length&&e[o][u]>-1&&e[o][u]!=1/0&&l.push([o,u])}if(l.length>0){var s=l[Math.floor(Math.random()*l.length)],h=s[0],f=s[1];return e[h][f]}return 0},o.onPlacePuzzle=function(e,t){for(var n,r=C.getBuff(B.BD_GRAVITY),l=1/0,i=-1,a=0;a<e.length;a++)e[a][1]<l&&(l=e[a][1]),e[a][1]>i&&(i=e[a][1]);var o=C.getBoard().map((function(e){return e.slice()})),u=null,s=0;r>0?s=l-0:r<0&&(s=o.length-1-i);for(var h=0;h<=s;h++){for(var f=0,c=0;c<e.length;c++){var p=e[c],g=p[0],b=p[1];if(-1!=o[g][b-h*r])break;f++}if(f!=e.length)break;u=h*r}if(null!=u){for(var z=parseInt(t),d=0;d<e.length;d++){var v=e[d],P=v[0],E=v[1];o[P][E-u]=z}C.setBoard(o),null==(n=this.puzzleCtrl)||n.onPlacePuzzleCallback(u),this.checkResult(o)}else{var m;null==(m=this.puzzleCtrl)||m.onPlacePuzzleCallback(u)}},o.onPickPuzzle=function(e,t){for(var n=parseInt(t),r=C.getBoard().map((function(e){return e.slice()})),l=0;l<e.length;l++){var i=e[l],a=i[0],o=i[1];if(r[a][o]!=n)return;r[a][o]=-1}C.setBoard(r)},o.onStartButtonClicked=function(){this.changeGameState(v.GS_START)},o.onShareBtnClick=function(){this.shareMenu&&(0==this.shareMenu.active?this.shareMenu.active=!0:this.shareMenu.active=!1)},o.onCopyBtnClick=function(){var e=i(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shareEdit){e.next=3;break}return e.next=3,navigator.clipboard.writeText(this.shareEdit.string);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.onPreloadData=function(e){this.initBoard(e),this.changeGameState(v.GS_HELP)},o.checkResult=function(e){if(!C.getHelpMode()){for(var t=0;t<e.length;t++)for(var n=0;n<e[t].length;n++)if(-1==e[t][n])return;this.changeGameState(v.GS_BUFF)}},o.setMenuVisible=function(e){this.stageLabel&&(this.stageLabel.string=e==v.GS_START?"Stage"+C.getStage():""),this.buffMenu&&(this.buffMenu.active=e==v.GS_BUFF),this.shareBtn&&(this.shareBtn.active=e!=v.GS_BUFF),this.shareMenu&&(this.shareMenu.active=!1),this.btnStart&&(this.btnStart.active=!1),this.titleLabel&&(this.titleLabel.string=""),this.screenshotBtn&&(this.screenshotBtn.active=e==v.GS_HELP),this.shareEdit&&(this.shareEdit.string=""+C.getQueryString())},t}(z)).prototype,"cellPrefab",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(I.prototype,"puzzleCtrl",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(I.prototype,"buffCtrl",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(I.prototype,"proloadCtrl",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(I.prototype,"buffMenu",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(I.prototype,"btnStart",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(I.prototype,"titleLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(I.prototype,"stageLabel",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(I.prototype,"shareBtn",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(I.prototype,"shareMenu",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(I.prototype,"shareEdit",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(I.prototype,"screenshotBtn",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=I))||H));o._RF.pop()}}}));

System.register("chunks:///_virtual/GameModel.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"3ed4fPz+JtG/7O1tueJ7qje","GameModel",void 0);var n=t("CELL_WIDTH",60),u=(t("FIT_ALLOW",Math.floor(n/4)),t("ADD_NEAR_RATE",[1,1,1,.7,.5,.3]),t("MAX_BOARD_LENGTH",10),t("MIN_BOARD_LENGTH",3)),i=(t("EGameState",function(t){return t[t.GS_BUFF=0]="GS_BUFF",t[t.GS_START=1]="GS_START",t[t.GS_HELP=2]="GS_HELP",t}({})),t("EGameEvents",function(t){return t.GE_ADD_BUFF="onSetBuffFinish",t.GE_PICK_PUZZLE="onPickPuzzle",t.GE_PLACE_PUZZLE="onPlacePuzzle",t.GE_PRELOADED="onFoundPreloadData",t}({})),t("EBuffType",function(t){return t[t.BD_SIZE=0]="BD_SIZE",t[t.BD_HUE=1]="BD_HUE",t[t.BD_ROTATE=2]="BD_ROTATE",t[t.BD_OBSTACLE=3]="BD_OBSTACLE",t[t.BD_ONECELL=4]="BD_ONECELL",t[t.BD_GRAVITY=5]="BD_GRAVITY",t[t.BD_MAX=6]="BD_MAX",t}({}))),r=t("CGameModel",function(){function t(){this.boardLength=u,this.stage=1,this.board=[],this.puzzles=[],this.buffData=new Array(i.BD_MAX).fill(0),this.queryString="",this.helpMode=!1}var e=t.prototype;return e.addBoardLength=function(){this.boardLength++},e.decreaseBoardLength=function(){this.boardLength--},e.setBoardLength=function(t){this.boardLength=t},e.addStage=function(){this.stage++},e.setStage=function(t){this.stage=t},e.setBoard=function(t){this.board=t.map((function(t){return t.slice()}))},e.setPuzzles=function(t){this.puzzles=t.map((function(t){return t.map((function(t){return t.slice()}))}))},e.addBuff=function(t){this.buffData[t]++},e.decreaseBuff=function(t){this.buffData[t]--},e.removeBuff=function(t){this.buffData[t]=0},e.setBuff=function(t,e){this.buffData[t]=e},e.setQueryString=function(t){this.queryString=t},e.setHelpMode=function(t){this.helpMode=t},e.getBoardLength=function(){return this.boardLength},e.getStage=function(){return this.stage},e.getBoard=function(){return this.board},e.getPuzzles=function(){return this.puzzles},e.getBuff=function(t){return this.buffData[t]},e.getQueryString=function(){return this.queryString},e.getHelpMode=function(){return this.helpMode},t}());t("GameModel",new r);e._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./BuffController.ts","./GameController.ts","./GameModel.ts","./PreloadController.ts","./PuzzleController.ts","./ScreenshotController.ts"],(function(){return{setters:[null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PreloadController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts"],(function(t){var r,e,n,o,a,i,s,u,l;return{setters:[function(t){r=t.inheritsLoose},function(t){e=t.cclegacy,n=t._decorator,o=t.Component},function(t){a=t.MIN_BOARD_LENGTH,i=t.MAX_BOARD_LENGTH,s=t.GameModel,u=t.EBuffType,l=t.EGameEvents}],execute:function(){var f;e._RF.push({},"93c8eqZylNB/I9K5UHNdRrs","PreloadController",void 0);var g=n.ccclass;t("PreloadController",g("PreloadController")(f=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.start=function(){if("undefined"!=typeof window){var t=new URLSearchParams(window.location.search);this.loadQueryString(t)}},n.update=function(t){},n.loadQueryString=function(t){if(t.has("b")&&t.has("r")&&t.has("g")&&t.has("o")&&t.has("p")){var r=parseInt(t.get("b"));if(isNaN(r)||r<a||r>i)return;var e=parseInt(t.get("r"));if(isNaN(e)||e<0||e>1)return;var n=parseInt(t.get("g"));if(isNaN(n)||n<-1||n>1)return;var o=t.get("o");if(!/^\d+$/.test(o)||o.length%2!=0&&"0"!=o)return;for(var f=t.getAll("p"),g=0;g<f.length;g++){var c=f[g];if(!/^\d+$/.test(c)||c.length%2!=0)return}s.setBoardLength(r),s.setBuff(u.BD_ROTATE,e),s.setBuff(u.BD_GRAVITY,n);var h=new Set;if("0"!=o)for(var p=0;p<o.length;p+=2){var v=[parseInt(o[p]),parseInt(o[p+1])],d=v[0],B=v[1];h.add(d*r+B)}for(var S=[],_=0;_<f.length;_++){for(var y=f[_],I=[],N=0;N<y.length;N+=2){var R=[parseInt(y[N]),parseInt(y[N+1])],m=R[0],E=R[1];I.push([m,E])}S.push(I)}s.setPuzzles(S),this.node.emit(l.GE_PRELOADED,h)}},n.setQueryString=function(){var t="https://youthtion.github.io/cocos_web/puzzle?",r=s.getBoard().map((function(t){return t.slice()}));t+="b="+r.length.toString(),t+="&r="+s.getBuff(u.BD_ROTATE).toString(),t+="&g="+s.getBuff(u.BD_GRAVITY).toString();for(var e="",n=0;n<r.length;n++)for(var o=0;o<r[n].length;o++)r[n][o]==1/0&&(e+=n.toString()+o.toString());t+=""==e?"&o=0":"&o="+e;for(var a=s.getPuzzles().map((function(t){return t.map((function(t){return t.slice()}))})),i=0;i<a.length;i++){t+="&p=";for(var l=0;l<a[i].length;l++){var f=a[i][l],g=f[0],c=f[1];t+=g.toString()+c.toString()}}s.setQueryString(t)},e}(o))||f);e._RF.pop()}}}));

System.register("chunks:///_virtual/PuzzleController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts"],(function(e){var t,n,o,i,l,r,a,s,u,h,c,f,g,p,z,P,d,M,v,y,E,T;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){l=e.cclegacy,r=e._decorator,a=e.Prefab,s=e.CCFloat,u=e.Vec3,h=e.input,c=e.Input,f=e.UITransform,g=e.Color,p=e.Component,z=e.Node,P=e.instantiate,d=e.Sprite},function(e){M=e.GameModel,v=e.EBuffType,y=e.EGameEvents,E=e.CELL_WIDTH,T=e.FIT_ALLOW}],execute:function(){var C,b,_,S,m,U,L,I,x;l._RF.push({},"4b28053qTlNFqEjoH7O1aS0","PuzzleController",void 0);var O=r.ccclass,w=r.property,A=function(e){return e[e.MT_LEFT=0]="MT_LEFT",e[e.MT_MID=1]="MT_MID",e[e.MT_RIGHT=2]="MT_RIGHT",e}(A||{});e("PuzzleController",(C=O("PuzzleController"),b=w({type:a}),_=w({type:s,min:0,max:1,step:.01}),S=w({type:s,min:0,max:1,step:.01}),C((L=t((U=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return t=e.call.apply(e,[this].concat(l))||this,o(t,"cellPrefab",L,i(t)),o(t,"cellSaturation",I,i(t)),o(t,"cellLightness",x,i(t)),t.fitCells=[],t.placePuzzlePos=[0,0],t.dragPuzzle=null,t.dragStartPos=new u,t.puzzleStartPos=new u,t}n(t,e);var l=t.prototype;return l.start=function(){},l.update=function(e){},l.setEventsActive=function(e){e?(h.on(c.EventType.MOUSE_MOVE,this.onMouseMove,this),h.on(c.EventType.MOUSE_UP,this.onMouseUp,this)):(h.off(c.EventType.MOUSE_MOVE,this.onMouseMove,this),h.off(c.EventType.MOUSE_UP,this.onMouseUp,this))},l.initPuzzle=function(){var e=this;if(this.cellPrefab){var t=M.getBoard(),n=M.getPuzzles().map((function(e){return e.map((function(e){return e.slice()}))})),o=this.generateHueColors(n.length*(M.getBuff(v.BD_HUE)+1));this.node.removeAllChildren();for(var i=function(){for(var i=new z(""+l),r=n[l][0],a=r[0],s=r[1],u=0;u<n[l].length;u++){var h=P(e.cellPrefab);if(h){i.addChild(h);var f=n[l][u],g=f[0],p=f[1];h.setPosition((g-a)*E,(p-s)*E,0);var M=h.getComponent(d);M&&(M.color=o[l]),h.on(c.EventType.MOUSE_DOWN,(function(t){e.onMouseDown(t,i)}),e),h.on(c.EventType.MOUSE_MOVE,e.onMouseMove,e),h.on(c.EventType.MOUSE_UP,e.onMouseUp,e)}}i.setPosition(t.length*E*-1,0,0),e.node.addChild(i)},l=0;l<n.length;l++)i()}},l.onMouseDown=function(e,t){if(t.parent)if(t.setSiblingIndex(t.parent.children.length-1),this.getFitCell(t),this.fitCells.length==t.children.length&&this.node.emit(y.GE_PICK_PUZZLE,this.fitCells,t.name),0==M.getBuff(v.BD_ROTATE)&&e.getButton()==A.MT_RIGHT){var n=new u(e.getUILocation().x,e.getUILocation().y,0),o=t.parent.getComponent(f).convertToNodeSpaceAR(n),i=t.getPosition(),l=new u(o.x-i.x,o.y-i.y,0),r=[Math.cos(Math.PI/-2),Math.sin(Math.PI/-2)],a=r[0],s=r[1],h=l.x*a-l.y*s,c=l.x*s+l.y*a,g=o.x-h,p=o.y-c;t.setPosition(g,p,0),t.eulerAngles=new u(t.eulerAngles.x,t.eulerAngles.y,(t.eulerAngles.z-90)%360)}else e.getButton()!=A.MT_LEFT||this.dragPuzzle||(this.puzzleStartPos.set(t.getPosition()),this.dragStartPos.set(e.getUILocation().x,e.getUILocation().y,0),this.dragPuzzle=t)},l.onMouseMove=function(e){if(this.dragPuzzle){var t=e.getUILocation(),n=this.dragStartPos.x-t.x,o=this.dragStartPos.y-t.y;this.dragPuzzle.setPosition(this.puzzleStartPos.x-n,this.puzzleStartPos.y-o)}},l.onMouseUp=function(e){if(this.dragPuzzle){if(this.getFitCell(this.dragPuzzle),this.fitCells.length==this.dragPuzzle.children.length)return void this.node.emit(y.GE_PLACE_PUZZLE,this.fitCells,this.dragPuzzle.name);this.dragPuzzle=null}},l.getFitCell=function(e){var t=0,n=0;if(this.fitCells=[],e.parent)for(var o=M.getBoard(),i=0;i<e.children.length;i++){var l=e.children[i].getWorldPosition(),r=e.parent.getComponent(f).convertToNodeSpaceAR(l),a=[r.x,r.y],s=a[0],u=a[1];if(Math.abs(s)>E*(o.length-1)/2+T||Math.abs(u)>E*(o.length-1)/2+T)break;if(o.length%2==0){var h=[s+.5*E,u+.5*E];s=h[0],u=h[1]}if(Math.abs(s%E)>T&&Math.abs(s%E)<E-T)break;if(Math.abs(u%E)>T&&Math.abs(u%E)<E-T)break;if(0==t&&0==n){(t=(s%E+E)%E)>T&&(t-=E),(n=(u%E+E)%E)>T&&(n-=E);var c=e.getPosition();this.placePuzzlePos=[c.x-t,c.y-n]}var g=[s-t,u-n];s=g[0],u=g[1],this.fitCells.push([Math.round(s/E+Math.floor((o.length-1)/2)),Math.round(u/E+Math.floor((o.length-1)/2))])}},l.onPlacePuzzleCallback=function(e){this.dragPuzzle&&null!=e&&(this.dragPuzzle.setPosition(this.placePuzzlePos[0],this.placePuzzlePos[1]-Math.round(e*E),0),this.placePuzzlePos=[0,0]),this.dragPuzzle=null},l.hslToRgb=function(e,t,n){var o,i,l;if(0==t)o=i=l=n;else{var r=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:s},a=n<.5?n*(1+t):n+t-n*t,s=2*n-a;o=r(s,a,e+1/3),i=r(s,a,e),l=r(s,a,e-1/3)}return[255*o,255*i,255*l]},l.generateHueColors=function(e){for(var t=[],n=0;n<e;n++){var o=n/e,i=this.hslToRgb(o,this.cellSaturation,this.cellLightness),l=i[0],r=i[1],a=i[2];t.push(new g(l,r,a))}return t},t}(p)).prototype,"cellPrefab",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(U.prototype,"cellSaturation",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),x=t(U.prototype,"cellLightness",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),m=U))||m));l._RF.pop()}}}));

System.register("chunks:///_virtual/ScreenshotController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n,a,o,i,c,l,s,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,a=e.assertThisInitialized,o=e.asyncToGenerator,i=e.regeneratorRuntime},function(e){c=e.cclegacy,l=e._decorator,s=e.Camera,u=e.Component}],execute:function(){var p,h,f,g,m;c._RF.push({},"959e54MyFBP2L9Vu8M7LlBH","ScreenshotController",void 0);var v=l.ccclass,d=l.property;e("ScreenshotController",(p=v("ScreenshotController"),h=d(s),p((m=t((g=function(e){function t(){for(var t,r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=e.call.apply(e,[this].concat(o))||this,n(t,"screenshotCamera",m,a(t)),t}r(t,e);var c=t.prototype;return c.start=function(){},c.update=function(e){},c.onScreenshotClick=function(){var e=this.screenshotCamera.targetTexture;if(e){var t=[e.width,e.height],r=t[0],n=t[1],a=e.readPixels(),o=document.createElement("canvas"),i=[r,n];o.width=i[0],o.height=i[1];for(var c=o.getContext("2d"),l=c.createImageData(r,n),s=0;s<n;s++)for(var u=0;u<r;u++){var p=4*((n-s-1)*r+u),h=4*(s*r+u);l.data.set(a.slice(p,p+4),h)}c.putImageData(l,0,0),o.toBlob(this.toBlobCallBack,"image/png")}},c.toBlobCallBack=function(){var e=o(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,navigator.clipboard.write([new ClipboardItem({"image/png":t})]);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t}(u)).prototype,"screenshotCamera",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=g))||f));c._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});