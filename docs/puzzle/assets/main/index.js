System.register("chunks:///_virtual/BuffController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts"],(function(t){var f,e,i,B,u,s,_,r,n,U,b,a,E,h,L,l,o,p,S,c,F,R,O;return{setters:[function(t){f=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,B=t.assertThisInitialized},function(t){u=t.cclegacy,s=t._decorator,_=t.Node,r=t.Label,n=t.Sprite,U=t.CCInteger,b=t.SpriteAtlas,a=t.Component},function(t){E=t.GameModel,h=t.EBuffType,L=t.MIN_BOARD_LENGTH,l=t.MAX_BOARD_LENGTH,o=t.EGameEvents,p=t.MIN_SIZE_BUFF,S=t.MAX_SIZE_BUFF,c=t.MAX_OBSTACLE_BUFF,F=t.MAX_ONECELL_BUFF,R=t.MAX_BUFF_NUM,O=t.ADD_NEAR_RATE}],execute:function(){var A,T,D,g,C,Z,d,G,N,M,y,P,H,v,I,w,m,Y,z,X,W,k,V,x,j,Q,q,J,K,$;u._RF.push({},"efd9cZ2vtdGkZunZzVclwQC","BuffController",void 0);var tt=s.ccclass,ft=s.property,et=function(t){return t[t.BU_GROW_STOP=0]="BU_GROW_STOP",t[t.BU_GROW_DEC=1]="BU_GROW_DEC",t[t.BU_SMALLER_PUZZLE=2]="BU_SMALLER_PUZZLE",t[t.BU_BIGGER_PUZZLE=3]="BU_BIGGER_PUZZLE",t[t.BU_LESS_HUE=4]="BU_LESS_HUE",t[t.BU_MORE_HUE=5]="BU_MORE_HUE",t[t.BU_ADD_OBSTACLE=6]="BU_ADD_OBSTACLE",t[t.BU_DEC_OBSTACLE=7]="BU_DEC_OBSTACLE",t[t.BU_GET_1X1_PUZZLE=8]="BU_GET_1X1_PUZZLE",t[t.BU_LOSE_1X1_PUZZLE=9]="BU_LOSE_1X1_PUZZLE",t[t.BU_CANNOT_ROTATE=10]="BU_CANNOT_ROTATE",t[t.BU_LESS_BUFF=11]="BU_LESS_BUFF",t[t.BU_BUFF_START=11]="BU_BUFF_START",t[t.BU_ONE_BUFF=12]="BU_ONE_BUFF",t[t.BU_TWO_BUFF=13]="BU_TWO_BUFF",t[t.BU_THREE_BUFF=14]="BU_THREE_BUFF",t[t.BU_MORE_BUFF=15]="BU_MORE_BUFF",t[t.BU_REFRESH=16]="BU_REFRESH",t[t.BU_GRAVITY=17]="BU_GRAVITY",t[t.BU_BUOYANCY=18]="BU_BUOYANCY",t[t.BU_PASS=19]="BU_PASS",t}(et||{}),it=((A={})[et.BU_GROW_STOP]="底板不擴大(1場)",A[et.BU_GROW_DEC]="底板縮小",A[et.BU_SMALLER_PUZZLE]="小方塊變多",A[et.BU_BIGGER_PUZZLE]="大方塊變多",A[et.BU_LESS_HUE]="方塊色差小",A[et.BU_MORE_HUE]="方塊色差大",A[et.BU_ADD_OBSTACLE]="底板缺格增加",A[et.BU_DEC_OBSTACLE]="底板缺格減少",A[et.BU_GET_1X1_PUZZLE]="獲得1x1方塊",A[et.BU_LOSE_1X1_PUZZLE]="失去1x1方塊\n出現底板縮小",A[et.BU_CANNOT_ROTATE]="不可旋轉(1場)\n出現底板縮小",A[et.BU_LESS_BUFF]="選項減少\n獲得刷新次數",A[et.BU_ONE_BUFF]="",A[et.BU_TWO_BUFF]="",A[et.BU_THREE_BUFF]="",A[et.BU_MORE_BUFF]="選項增加",A[et.BU_REFRESH]="刷新選項",A[et.BU_GRAVITY]="產生重力(1場)",A[et.BU_BUOYANCY]="產生浮力(1場)",A[et.BU_PASS]="跳過",A);t("BuffController",(T=tt("BuffController"),D=ft({type:_}),g=ft({type:r}),C=ft({type:_}),Z=ft({type:_}),d=ft({type:_}),G=ft({type:r}),N=ft({type:r}),M=ft({type:r}),y=ft({type:n}),P=ft({type:n}),H=ft({type:n}),v=ft({type:U}),I=ft({type:b}),T((Y=f((m=function(t){function f(){for(var f,e=arguments.length,u=new Array(e),s=0;s<e;s++)u[s]=arguments[s];return f=t.call.apply(t,[this].concat(u))||this,i(f,"refreshBtn",Y,B(f)),i(f,"freshLabel",z,B(f)),i(f,"buffBtn1",X,B(f)),i(f,"buffBtn2",W,B(f)),i(f,"buffBtn3",k,B(f)),i(f,"buffLabel1",V,B(f)),i(f,"buffLabel2",x,B(f)),i(f,"buffLabel3",j,B(f)),i(f,"buffSprite1",Q,B(f)),i(f,"buffSprite2",q,B(f)),i(f,"buffSprite3",J,B(f)),i(f,"buffSpace",K,B(f)),i(f,"buffAtlas",$,B(f)),f.buffBtns=[],f.buffLabels=[],f.buffSprites=[],f.buffList=[],f}e(f,t);var u=f.prototype;return u.start=function(){this.buffBtn1&&this.buffBtns.push(this.buffBtn1),this.buffBtn2&&this.buffBtns.push(this.buffBtn2),this.buffBtn3&&this.buffBtns.push(this.buffBtn3),this.buffLabel1&&this.buffLabels.push(this.buffLabel1),this.buffLabel2&&this.buffLabels.push(this.buffLabel2),this.buffLabel3&&this.buffLabels.push(this.buffLabel3),this.buffSprite1&&this.buffSprites.push(this.buffSprite1),this.buffSprite2&&this.buffSprites.push(this.buffSprite2),this.buffSprite3&&this.buffSprites.push(this.buffSprite3)},u.update=function(t){},u.showBuffBtn=function(){for(var t=0;t<this.buffBtns.length;t++)if(E.getBuff(h.BD_BUFFNUM)>t&&t<this.buffList.length){this.buffBtns[t].active=!0,this.buffBtns[t].setPosition(this.buffSpace*(E.getBuff(h.BD_BUFFNUM)-1)*-.5+t*this.buffSpace,0,0),this.buffLabels[t].string=it[this.buffList[t]];var f=this.buffList[t];this.buffList[t]==et.BU_LESS_BUFF?f=et.BU_BUFF_START+(E.getBuff(h.BD_BUFFNUM)-1):this.buffList[t]==et.BU_MORE_BUFF&&(f=et.BU_BUFF_START+(E.getBuff(h.BD_BUFFNUM)+1)),this.buffSprites[t].spriteFrame=this.buffAtlas.getSpriteFrame(""+f)}else this.buffBtns[t].active=!1;this.refreshBtn&&(this.refreshBtn.active=E.getBuff(h.BD_REFRESH)>0,this.freshLabel&&(this.freshLabel.string=""+E.getBuff(h.BD_REFRESH)))},u.onBuffClick=function(t,f){this.setBuff(f)},u.onRefreshClick=function(){E.decreaseBuff(h.BD_REFRESH),this.generateBuffList(),this.showBuffBtn()},u.getBuffAddNearRate=function(){for(var t=O.slice(),f=3;f<t.length;f++)t[f]+=.1*E.getBuff(h.BD_SIZE),t[f]>1?t[f]=1:t[f]<0&&(t[f]=0);return t},u.setBuff=function(t){if(!(t<0||t>=this.buffList.length)){var f=this.buffList[t];switch(f){case et.BU_GROW_DEC:E.getBoardLength()>L&&E.decreaseBoardLength();break;case et.BU_SMALLER_PUZZLE:E.decreaseBuff(h.BD_SIZE);break;case et.BU_BIGGER_PUZZLE:E.addBuff(h.BD_SIZE);break;case et.BU_LESS_HUE:E.addBuff(h.BD_HUE);break;case et.BU_MORE_HUE:E.decreaseBuff(h.BD_HUE);break;case et.BU_ADD_OBSTACLE:E.addBuff(h.BD_OBSTACLE);break;case et.BU_DEC_OBSTACLE:E.decreaseBuff(h.BD_OBSTACLE);break;case et.BU_GET_1X1_PUZZLE:E.addBuff(h.BD_ONECELL);break;case et.BU_LOSE_1X1_PUZZLE:return E.decreaseBuff(h.BD_ONECELL),this.buffList[t]=et.BU_GROW_DEC,void this.showBuffBtn();case et.BU_CANNOT_ROTATE:return E.setBuff(h.BD_ROTATE,1),this.buffList[t]=et.BU_GROW_DEC,void this.showBuffBtn();case et.BU_LESS_BUFF:return E.decreaseBuff(h.BD_BUFFNUM),E.addBuff(h.BD_REFRESH),this.buffList.splice(t,1),void this.showBuffBtn();case et.BU_MORE_BUFF:E.addBuff(h.BD_BUFFNUM);var e=[this.buffList[this.buffList.length-1],this.buffList[t]];return this.buffList[t]=e[0],this.buffList[this.buffList.length-1]=e[1],void this.showBuffBtn();case et.BU_REFRESH:return this.generateBuffList(),void this.showBuffBtn();case et.BU_GRAVITY:E.setBuff(h.BD_GRAVITY,1);break;case et.BU_BUOYANCY:E.setBuff(h.BD_GRAVITY,-1)}f>et.BU_GROW_DEC&&E.getBoardLength()<l&&E.addBoardLength(),this.node.emit(o.GE_ADD_BUFF)}},u.generateBuffList=function(){this.buffList=[],E.getBoardLength()<l&&this.buffList.push(et.BU_GROW_STOP),E.getBuff(h.BD_SIZE)>p&&this.buffList.push(et.BU_SMALLER_PUZZLE),E.getBuff(h.BD_SIZE)<S&&this.buffList.push(et.BU_BIGGER_PUZZLE),this.buffList.push(et.BU_LESS_HUE),E.getBuff(h.BD_HUE)>0&&this.buffList.push(et.BU_MORE_HUE),E.getBuff(h.BD_OBSTACLE)<c&&this.buffList.push(et.BU_ADD_OBSTACLE),E.getBuff(h.BD_OBSTACLE)>0&&this.buffList.push(et.BU_DEC_OBSTACLE),E.getBuff(h.BD_ONECELL)<F&&this.buffList.push(et.BU_GET_1X1_PUZZLE),E.getBoardLength()>L&&(E.getBuff(h.BD_ONECELL)>0&&this.buffList.push(et.BU_LOSE_1X1_PUZZLE),0==E.getBuff(h.BD_ROTATE)&&this.buffList.push(et.BU_CANNOT_ROTATE)),E.getBuff(h.BD_BUFFNUM)>1&&this.buffList.push(et.BU_LESS_BUFF),E.getBuff(h.BD_BUFFNUM)<R&&this.buffList.push(et.BU_MORE_BUFF),this.buffList.push(et.BU_REFRESH),0==E.getBuff(h.BD_GRAVITY)&&(this.buffList.push(et.BU_GRAVITY),this.buffList.push(et.BU_BUOYANCY)),this.buffList.push(et.BU_PASS);for(var t=0;t<this.buffList.length;t++){var f=Math.floor(Math.random()*(this.buffList.length-t))+t,e=[this.buffList[f],this.buffList[t]];this.buffList[t]=e[0],this.buffList[f]=e[1]}},f}(a)).prototype,"refreshBtn",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=f(m.prototype,"freshLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=f(m.prototype,"buffBtn1",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=f(m.prototype,"buffBtn2",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=f(m.prototype,"buffBtn3",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=f(m.prototype,"buffLabel1",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=f(m.prototype,"buffLabel2",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=f(m.prototype,"buffLabel3",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=f(m.prototype,"buffSprite1",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=f(m.prototype,"buffSprite2",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=f(m.prototype,"buffSprite3",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=f(m.prototype,"buffSpace",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$=f(m.prototype,"buffAtlas",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=m))||w));u._RF.pop()}}}));

System.register("chunks:///_virtual/GameController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts","./PuzzleController.ts","./BuffController.ts","./PreloadController.ts"],(function(e){var t,n,r,i,l,a,o,u,s,h,f,c,p,g,z,b,d,v,C,m,P,B,E,y,S,_,A;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized,l=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){o=e.cclegacy,u=e._decorator,s=e.Color,h=e.Prefab,f=e.Node,c=e.Label,p=e.EditBox,g=e.Animation,z=e.CCInteger,b=e.instantiate,d=e.Sprite,v=e.Component},function(e){C=e.EGameEvents,m=e.EGameState,P=e.GameModel,B=e.EBuffType,E=e.CELL_WIDTH,y=e.ADD_NEAR_RATE},function(e){S=e.PuzzleController},function(e){_=e.BuffController},function(e){A=e.PreloadController}],execute:function(){var G,L,M,w,T,D,k,R,F,N,O,I,U,Z,H,x,Q,V,K,Y,j,W,q,J,X,$,ee,te,ne,re,ie;o._RF.push({},"7e675OHFblFTawCzOgyllbA","GameController",void 0);var le=u.ccclass,ae=u.property,oe=new s(64,64,64),ue=new s(0,0,0);e("GameController",(G=le("GameController"),L=ae({type:h}),M=ae({type:S}),w=ae({type:_}),T=ae({type:A}),D=ae({type:f}),k=ae({type:f}),R=ae({type:c}),F=ae({type:c}),N=ae({type:f}),O=ae({type:f}),I=ae({type:p}),U=ae({type:f}),Z=ae({type:g}),H=ae({type:z,min:1}),G((V=t((Q=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),a=0;a<n;a++)l[a]=arguments[a];return t=e.call.apply(e,[this].concat(l))||this,r(t,"cellPrefab",V,i(t)),r(t,"puzzleCtrl",K,i(t)),r(t,"buffCtrl",Y,i(t)),r(t,"preloadCtrl",j,i(t)),r(t,"buffMenu",W,i(t)),r(t,"btnStart",q,i(t)),r(t,"titleLabel",J,i(t)),r(t,"stageLabel",X,i(t)),r(t,"shareBtn",$,i(t)),r(t,"shareMenu",ee,i(t)),r(t,"shareEdit",te,i(t)),r(t,"screenshotBtn",ne,i(t)),r(t,"tipAnim",re,i(t)),r(t,"tipTimeLength",ie,i(t)),t}n(t,e);var o=t.prototype;return o.start=function(){var e,t;null==(e=this.preloadCtrl)||e.node.on(C.GE_PRELOADED,this.onPreloadData,this),null==(t=this.buffCtrl)||t.node.on(C.GE_ADD_BUFF,this.onStartButtonClicked,this)},o.changeGameState=function(e){var t,n,r,i,l,a,o,u,s,h,f,c,p;switch(e){case m.GS_BUFF:P.addStage(),P.removeBuff(B.BD_ROTATE),P.removeBuff(B.BD_GRAVITY),null==(t=this.buffCtrl)||t.generateBuffList(),null==(n=this.buffCtrl)||n.showBuffBtn(),null==(r=this.puzzleCtrl)||r.setEventsActive(!1),this.setEventsActive(!1);break;case m.GS_START:this.initBoard(),this.generatePuzzle(),null==(i=this.puzzleCtrl)||i.initPuzzle(),null==(l=this.puzzleCtrl)||l.setEventsActive(!0),null==(a=this.preloadCtrl)||a.setQueryString(),null==(o=this.preloadCtrl)||o.saveCookie(),this.setEventsActive(!0);break;case m.GS_HELP:null==(u=this.puzzleCtrl)||u.initPuzzle(),null==(s=this.puzzleCtrl)||s.setEventsActive(!0),null==(h=this.preloadCtrl)||h.setQueryString(),this.setEventsActive(!0),P.setHelpMode(!0);break;case m.GS_CONTINUE:null==(f=this.puzzleCtrl)||f.initPuzzle(),null==(c=this.puzzleCtrl)||c.setEventsActive(!0),null==(p=this.preloadCtrl)||p.setQueryString(),this.setEventsActive(!0)}this.setMenuVisible(e)},o.update=function(e){},o.setEventsActive=function(e){var t,n,r,i;e?(null==(t=this.puzzleCtrl)||t.node.on(C.GE_PLACE_PUZZLE,this.onPlacePuzzle,this),null==(n=this.puzzleCtrl)||n.node.on(C.GE_PICK_PUZZLE,this.onPickPuzzle,this)):(null==(r=this.puzzleCtrl)||r.node.off(C.GE_PLACE_PUZZLE,this.onPlacePuzzle,this),null==(i=this.puzzleCtrl)||i.node.off(C.GE_PICK_PUZZLE,this.onPickPuzzle,this))},o.initBoard=function(e){if(void 0===e&&(e=new Set),this.cellPrefab){var t=P.getBoardLength(),n=[];if(this.node.removeAllChildren(),0==e.size&&P.getBuff(B.BD_OBSTACLE)>0)for(var r=P.getBuff(B.BD_OBSTACLE),i=Math.floor(t*t/r),l=0;l<r;l++)e.add(Math.floor(Math.random()*i)+i*l);for(var a=0;a<t;a++){for(var o=[],u=0;u<t;u++){var s=b(this.cellPrefab);if(s){this.node.addChild(s),s.setPosition(a*E,u*E,0);var h=s.getComponent(d);e.size>0&&e.has(a*t+u)?(h&&(h.color=ue),o.push(1/0)):(h&&(h.color=oe),o.push(-1))}}n.push(o)}P.setBoard(n);var f=t*E*-.5+.5*E;this.node.setPosition(f,f,0)}},o.generatePuzzle=function(){for(var e=P.getBoard().map((function(e){return e.slice()})),t=[],n=P.getBuff(B.BD_ONECELL),r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)if(-1==e[r][i]){var l=t.length;if(t.push([[r,i]]),n>0)e[r][i]=1/0,n--;else if(e[r][i]=l,this.addNearCell(t,e),t[l].length<=1){var a=t[l][0],o=a[0],u=a[1],s=this.findNearPuzzle(e,o,u);t[s].push(t[l][0]),t.pop(),e[o][u]=s}}P.setPuzzles(t)},o.addNearCell=function(e,t){for(var n=e.length-1,r=e[n],i=t.map((function(e){return e.slice()})),l=[],a=[[1,0],[0,1]],o=0;o<r.length;o++)for(var u=r[o],s=u[0],h=u[1],f=0;f<a.length;f++){var c=a[f],p=s+c[0],g=h+c[1];p<i.length&&g<i[p].length&&-1==i[p][g]&&(l.push([p,g]),i[p][g]=0)}if(l.length>0&&r.length<y.length){var z,b=null==(z=this.buffCtrl)?void 0:z.getBuffAddNearRate().slice();if(Math.random()<b[r.length]){var d=Math.floor(Math.random()*l.length),v=l[d],C=v[0],m=v[1];e[n].push(l[d]),t[C][m]=n,this.addNearCell(e,t)}}},o.findNearPuzzle=function(e,t,n){for(var r=[[-1,0],[1,0],[0,1],[0,-1]],i=[],l=0;l<r.length;l++){var a=r[l],o=t+a[0],u=n+a[1];o>=0&&u>=0&&o<e.length&&u<e[o].length&&e[o][u]>-1&&e[o][u]!=1/0&&i.push([o,u])}if(i.length>0){var s=i[Math.floor(Math.random()*i.length)],h=s[0],f=s[1];return e[h][f]}return 0},o.onPlacePuzzle=function(e,t){for(var n,r=P.getBuff(B.BD_GRAVITY),i=1/0,l=-1,a=0;a<e.length;a++)e[a][1]<i&&(i=e[a][1]),e[a][1]>l&&(l=e[a][1]);var o=P.getBoard().map((function(e){return e.slice()})),u=null,s=0;r>0?s=i-0:r<0&&(s=o.length-1-l);for(var h=0;h<=s;h++){for(var f=0,c=0;c<e.length;c++){var p=e[c],g=p[0],z=p[1];if(-1!=o[g][z-h*r])break;f++}if(f!=e.length)break;u=h*r}if(null!=u){for(var b=parseInt(t),d=0;d<e.length;d++){var v=e[d],C=v[0],m=v[1];o[C][m-u]=b}P.setBoard(o),null==(n=this.puzzleCtrl)||n.onPlacePuzzleCallback(u),this.checkResult(o)}else{var E;null==(E=this.puzzleCtrl)||E.onPlacePuzzleCallback(null)}},o.onPickPuzzle=function(e,t){for(var n=parseInt(t),r=P.getBoard().map((function(e){return e.slice()})),i=0;i<e.length;i++){var l=e[i],a=l[0],o=l[1];if(r[a][o]!=n)return;r[a][o]=-1}P.setBoard(r)},o.onStartButtonClicked=function(){this.changeGameState(m.GS_START)},o.onShareBtnClick=function(){this.shareMenu&&(0==this.shareMenu.active?this.shareMenu.active=!0:this.shareMenu.active=!1)},o.onCopyBtnClick=function(){var e=l(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shareEdit){e.next=4;break}return e.next=3,navigator.clipboard.writeText(this.shareEdit.string);case 3:this.tipAnim&&((t=this.tipAnim.getState("fadeOut")).speed=t.duration/this.tipTimeLength,this.tipAnim.play("fadeOut"));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.onPreloadData=function(e,t){var n;this.initBoard(e),this.changeGameState(t),null==(n=this.preloadCtrl)||n.node.off(C.GE_PRELOADED,this.onPreloadData,this)},o.checkResult=function(e){if(!P.getHelpMode()){for(var t=0;t<e.length;t++)for(var n=0;n<e[t].length;n++)if(-1==e[t][n])return;this.changeGameState(m.GS_BUFF)}},o.setMenuVisible=function(e){this.stageLabel&&(this.stageLabel.string=e==m.GS_START||e==m.GS_CONTINUE?"Stage"+P.getStage():""),this.buffMenu&&(this.buffMenu.active=e==m.GS_BUFF),this.shareBtn&&(this.shareBtn.active=e!=m.GS_BUFF),this.shareMenu&&(this.shareMenu.active=!1),this.btnStart&&(this.btnStart.active=!1),this.titleLabel&&(this.titleLabel.string=""),this.screenshotBtn&&(this.screenshotBtn.active=e==m.GS_HELP),this.shareEdit&&(this.shareEdit.string="https://youthtion.github.io/cocos_web/puzzle?"+P.getQueryString())},t}(v)).prototype,"cellPrefab",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(Q.prototype,"puzzleCtrl",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(Q.prototype,"buffCtrl",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(Q.prototype,"preloadCtrl",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(Q.prototype,"buffMenu",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(Q.prototype,"btnStart",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(Q.prototype,"titleLabel",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(Q.prototype,"stageLabel",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(Q.prototype,"shareBtn",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ee=t(Q.prototype,"shareMenu",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te=t(Q.prototype,"shareEdit",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ne=t(Q.prototype,"screenshotBtn",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),re=t(Q.prototype,"tipAnim",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ie=t(Q.prototype,"tipTimeLength",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),x=Q))||x));o._RF.pop()}}}));

System.register("chunks:///_virtual/GameModel.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"3ed4fPz+JtG/7O1tueJ7qje","GameModel",void 0);var n=t("CELL_WIDTH",60),u=(t("FIT_ALLOW",Math.floor(n/4)),t("ADD_NEAR_RATE",[1,1,1,.7,.5,.3]),t("MAX_BOARD_LENGTH",10),t("MIN_BOARD_LENGTH",3)),i=(t("MAX_SIZE_BUFF",3),t("MIN_SIZE_BUFF",-3),t("MAX_OBSTACLE_BUFF",4),t("MAX_ONECELL_BUFF",5),t("MAX_BUFF_NUM",3),t("EGameEvents",function(t){return t.GE_ADD_BUFF="onSetBuffFinish",t.GE_PICK_PUZZLE="onPickPuzzle",t.GE_PLACE_PUZZLE="onPlacePuzzle",t.GE_PRELOADED="onFoundPreloadData",t}({})),t("EGameState",function(t){return t[t.GS_BUFF=0]="GS_BUFF",t[t.GS_START=1]="GS_START",t[t.GS_HELP=2]="GS_HELP",t[t.GS_CONTINUE=3]="GS_CONTINUE",t}({})),t("EBuffType",function(t){return t[t.BD_SIZE=0]="BD_SIZE",t[t.BD_HUE=1]="BD_HUE",t[t.BD_ROTATE=2]="BD_ROTATE",t[t.BD_OBSTACLE=3]="BD_OBSTACLE",t[t.BD_ONECELL=4]="BD_ONECELL",t[t.BD_GRAVITY=5]="BD_GRAVITY",t[t.BD_REFRESH=6]="BD_REFRESH",t[t.BD_BUFFNUM=7]="BD_BUFFNUM",t[t.BD_MAX=8]="BD_MAX",t}({})),t("CGameModel",function(){function t(){this.boardLength=u,this.stage=1,this.board=[],this.puzzles=[],this.buffData=[0,0,0,0,0,0,0,2],this.queryString="",this.helpMode=!1}var e=t.prototype;return e.addBoardLength=function(){this.boardLength++},e.decreaseBoardLength=function(){this.boardLength--},e.setBoardLength=function(t){this.boardLength=t},e.addStage=function(){this.stage++},e.setStage=function(t){this.stage=t},e.setBoard=function(t){this.board=t.map((function(t){return t.slice()}))},e.setPuzzles=function(t){this.puzzles=t.map((function(t){return t.map((function(t){return t.slice()}))}))},e.addBuff=function(t){this.buffData[t]++},e.decreaseBuff=function(t){this.buffData[t]--},e.removeBuff=function(t){this.buffData[t]=0},e.setBuff=function(t,e){this.buffData[t]=e},e.setQueryString=function(t){this.queryString=t},e.setHelpMode=function(t){this.helpMode=t},e.getBoardLength=function(){return this.boardLength},e.getStage=function(){return this.stage},e.getBoard=function(){return this.board},e.getPuzzles=function(){return this.puzzles},e.getBuff=function(t){return this.buffData[t]},e.getQueryString=function(){return this.queryString},e.getHelpMode=function(){return this.helpMode},t}()));t("GameModel",new i);e._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./BuffController.ts","./GameController.ts","./GameModel.ts","./PreloadController.ts","./PuzzleController.ts","./ScreenshotController.ts"],(function(){return{setters:[null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PreloadController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts"],(function(t){var r,e,n,a,o,i,f,s,u,g,l,B,S,v,c;return{setters:[function(t){r=t.inheritsLoose},function(t){e=t.cclegacy,n=t._decorator,a=t.Component},function(t){o=t.MIN_SIZE_BUFF,i=t.MAX_SIZE_BUFF,f=t.MAX_OBSTACLE_BUFF,s=t.MAX_ONECELL_BUFF,u=t.MAX_BUFF_NUM,g=t.MIN_BOARD_LENGTH,l=t.MAX_BOARD_LENGTH,B=t.GameModel,S=t.EBuffType,v=t.EGameEvents,c=t.EGameState}],execute:function(){var h;e._RF.push({},"93c8eqZylNB/I9K5UHNdRrs","PreloadController",void 0);var p=n.ccclass;t("PreloadController",p("PreloadController")(h=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.start=function(){if("undefined"!=typeof window){var t=new URLSearchParams(window.location.search);this.loadQueryString(t)||this.loadCookie()}},n.update=function(t){},n.loadStage=function(t,r,e,n,a,c,h,p,_,E,N,d,D){var I=parseInt(t);if(isNaN(I))return!1;var A=parseInt(r);if(isNaN(A)||A<o||A>i)return!1;var F=parseInt(e);if(isNaN(F)||F>f)return!1;var R=parseInt(n);if(isNaN(R)||R>s)return!1;var m=parseInt(a);if(isNaN(m)||m<0)return!1;var L=parseInt(c);if(isNaN(L)||L>u||L<1)return!1;var T=parseInt(h);if(isNaN(T)||T<g||T>l)return!1;var U=parseInt(p);if(isNaN(U)||U<0)return!1;var C=parseInt(_);if(isNaN(C)||C<0||C>1)return!1;var M=parseInt(E);if(isNaN(M)||M<-1||M>1)return!1;var O=N;if(!/^\d+$/.test(O)||O.length%2!=0&&"0"!=O)return!1;for(var G=d,y=0;y<G.length;y++){var P=G[y];if(!/^\d+$/.test(P)||P.length%2!=0)return!1}B.setStage(I),B.setBuff(S.BD_SIZE,A),B.setBuff(S.BD_OBSTACLE,F),B.setBuff(S.BD_ONECELL,R),B.setBuff(S.BD_REFRESH,m),B.setBuff(S.BD_BUFFNUM,L),B.setBoardLength(T),B.setBuff(S.BD_HUE,U),B.setBuff(S.BD_ROTATE,C),B.setBuff(S.BD_GRAVITY,M);var H=new Set;if("0"!=O)for(var w=0;w<O.length;w+=2){var k=[parseInt(O[w]),parseInt(O[w+1])],z=k[0],X=k[1];H.add(z*T+X)}for(var Z=[],b=0;b<G.length;b++){for(var Q=G[b],x=[],V=0;V<Q.length;V+=2){var Y=[parseInt(Q[V]),parseInt(Q[V+1])],$=Y[0],j=Y[1];x.push([$,j])}Z.push(x)}return B.setPuzzles(Z),this.node.emit(v.GE_PRELOADED,H,D),!0},n.loadQueryString=function(t){return!!(t.has("b")&&t.has("h")&&t.has("r")&&t.has("g")&&t.has("o")&&t.has("p"))&&this.loadStage("1","0","0","0","0","2",t.get("b"),t.get("h"),t.get("r"),t.get("g"),t.get("o"),t.getAll("p"),c.GS_HELP)},n.setQueryString=function(){var t=B.getBoard().map((function(t){return t.slice()})),r="b="+t.length.toString();r+="&h="+B.getBuff(S.BD_HUE).toString(),r+="&r="+B.getBuff(S.BD_ROTATE).toString(),r+="&g="+B.getBuff(S.BD_GRAVITY).toString();for(var e="",n=0;n<t.length;n++)for(var a=0;a<t[n].length;a++)t[n][a]==1/0&&(e+=n.toString()+a.toString());r+=""==e?"&o=0":"&o="+e;for(var o=B.getPuzzles().map((function(t){return t.map((function(t){return t.slice()}))})),i=0;i<o.length;i++){r+="&p=";for(var f=0;f<o[i].length;f++){var s=o[i][f],u=s[0],g=s[1];r+=u.toString()+g.toString()}}B.setQueryString(r)},n.saveCookie=function(){var t=new Date(Date.now()+31536e6).toUTCString(),r="v1";r+="&"+B.getStage().toString(),r+="&"+B.getBuff(S.BD_SIZE).toString(),r+="&"+B.getBuff(S.BD_OBSTACLE).toString(),r+="&"+B.getBuff(S.BD_ONECELL).toString(),r+="&"+B.getBuff(S.BD_REFRESH).toString(),r+="&"+B.getBuff(S.BD_BUFFNUM).toString();var e=B.getBoard().map((function(t){return t.slice()}));r+="&"+e.length.toString(),r+="&"+B.getBuff(S.BD_HUE).toString(),r+="&"+B.getBuff(S.BD_ROTATE).toString(),r+="&"+B.getBuff(S.BD_GRAVITY).toString();for(var n="",a=0;a<e.length;a++)for(var o=0;o<e[a].length;o++)e[a][o]==1/0&&(n+=a.toString()+o.toString());r+=""==n?"&0":"&"+n;for(var i=B.getPuzzles().map((function(t){return t.map((function(t){return t.slice()}))})),f=0;f<i.length;f++){r+="&";for(var s=0;s<i[f].length;s++){var u=i[f][s],g=u[0],l=u[1];r+=g.toString()+l.toString()}}document.cookie="save="+r+"; expires="+t+"; path=/"},n.loadCookie=function(){var t=document.cookie.match(new RegExp("(?:^|; )save=([^;]*)"));if(t){for(var r=t[1].split("&"),e=[],n=12;n<r.length;n++)e.push(r[n]);this.loadStage(r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],e,c.GS_CONTINUE)}},e}(a))||h);e._RF.pop()}}}));

System.register("chunks:///_virtual/PuzzleController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts"],(function(e){var t,n,o,i,l,r,a,s,u,h,c,g,f,p,z,P,d,M,v,y,E,T;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){l=e.cclegacy,r=e._decorator,a=e.Prefab,s=e.CCFloat,u=e.Vec3,h=e.input,c=e.Input,g=e.UITransform,f=e.Color,p=e.Component,z=e.Node,P=e.instantiate,d=e.Sprite},function(e){M=e.GameModel,v=e.EBuffType,y=e.EGameEvents,E=e.CELL_WIDTH,T=e.FIT_ALLOW}],execute:function(){var C,b,_,S,m,U,L,I,x;l._RF.push({},"4b28053qTlNFqEjoH7O1aS0","PuzzleController",void 0);var O=r.ccclass,w=r.property,A=function(e){return e[e.MT_LEFT=0]="MT_LEFT",e[e.MT_MID=1]="MT_MID",e[e.MT_RIGHT=2]="MT_RIGHT",e}(A||{});e("PuzzleController",(C=O("PuzzleController"),b=w({type:a}),_=w({type:s,min:0,max:1,step:.01}),S=w({type:s,min:0,max:1,step:.01}),C((L=t((U=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return t=e.call.apply(e,[this].concat(l))||this,o(t,"cellPrefab",L,i(t)),o(t,"cellSaturation",I,i(t)),o(t,"cellLightness",x,i(t)),t.fitCells=[],t.placePuzzlePos=[0,0],t.dragPuzzle=null,t.dragStartPos=new u,t.puzzleStartPos=new u,t}n(t,e);var l=t.prototype;return l.start=function(){},l.update=function(e){},l.setEventsActive=function(e){e?(h.on(c.EventType.MOUSE_MOVE,this.onMouseMove,this),h.on(c.EventType.MOUSE_UP,this.onMouseUp,this)):(h.off(c.EventType.MOUSE_MOVE,this.onMouseMove,this),h.off(c.EventType.MOUSE_UP,this.onMouseUp,this))},l.initPuzzle=function(){var e=this;if(this.cellPrefab){var t=M.getBoard(),n=M.getPuzzles().map((function(e){return e.map((function(e){return e.slice()}))})),o=this.generateHueColors(n.length*(M.getBuff(v.BD_HUE)+1));this.node.removeAllChildren();for(var i=function(){for(var i=new z(""+l),r=n[l][0],a=r[0],s=r[1],u=0;u<n[l].length;u++){var h=P(e.cellPrefab);if(h){i.addChild(h);var g=n[l][u],f=g[0],p=g[1];h.setPosition((f-a)*E,(p-s)*E,0);var M=h.getComponent(d);M&&(M.color=o[l]),h.on(c.EventType.MOUSE_DOWN,(function(t){e.onMouseDown(t,i)}),e),h.on(c.EventType.MOUSE_MOVE,e.onMouseMove,e),h.on(c.EventType.MOUSE_UP,e.onMouseUp,e)}}i.setPosition(t.length*E*-1,t.length*E/n.length*l-t.length*E*.5,0),e.node.addChild(i)},l=0;l<n.length;l++)i()}},l.onMouseDown=function(e,t){if(t.parent)if(t.setSiblingIndex(t.parent.children.length-1),this.getFitCell(t),this.fitCells.length==t.children.length&&this.node.emit(y.GE_PICK_PUZZLE,this.fitCells,t.name),0==M.getBuff(v.BD_ROTATE)&&e.getButton()==A.MT_RIGHT){var n=new u(e.getUILocation().x,e.getUILocation().y,0),o=t.parent.getComponent(g).convertToNodeSpaceAR(n),i=t.getPosition(),l=new u(o.x-i.x,o.y-i.y,0),r=[Math.cos(Math.PI/-2),Math.sin(Math.PI/-2)],a=r[0],s=r[1],h=l.x*a-l.y*s,c=l.x*s+l.y*a,f=o.x-h,p=o.y-c;t.setPosition(f,p,0),t.eulerAngles=new u(t.eulerAngles.x,t.eulerAngles.y,(t.eulerAngles.z-90)%360)}else e.getButton()!=A.MT_LEFT||this.dragPuzzle||(this.puzzleStartPos.set(t.getPosition()),this.dragStartPos.set(e.getUILocation().x,e.getUILocation().y,0),this.dragPuzzle=t)},l.onMouseMove=function(e){if(this.dragPuzzle){var t=e.getUILocation(),n=this.dragStartPos.x-t.x,o=this.dragStartPos.y-t.y;this.dragPuzzle.setPosition(this.puzzleStartPos.x-n,this.puzzleStartPos.y-o)}},l.onMouseUp=function(e){if(this.dragPuzzle){if(this.getFitCell(this.dragPuzzle),this.fitCells.length==this.dragPuzzle.children.length)return void this.node.emit(y.GE_PLACE_PUZZLE,this.fitCells,this.dragPuzzle.name);this.dragPuzzle=null}},l.getFitCell=function(e){var t=0,n=0;if(this.fitCells=[],e.parent)for(var o=M.getBoard(),i=0;i<e.children.length;i++){var l=e.children[i].getWorldPosition(),r=e.parent.getComponent(g).convertToNodeSpaceAR(l),a=[r.x,r.y],s=a[0],u=a[1];if(Math.abs(s)>E*(o.length-1)/2+T||Math.abs(u)>E*(o.length-1)/2+T)break;if(o.length%2==0){var h=[s+.5*E,u+.5*E];s=h[0],u=h[1]}if(Math.abs(s%E)>T&&Math.abs(s%E)<E-T)break;if(Math.abs(u%E)>T&&Math.abs(u%E)<E-T)break;if(0==t&&0==n){(t=(s%E+E)%E)>T&&(t-=E),(n=(u%E+E)%E)>T&&(n-=E);var c=e.getPosition();this.placePuzzlePos=[c.x-t,c.y-n]}var f=[s-t,u-n];s=f[0],u=f[1],this.fitCells.push([Math.round(s/E+Math.floor((o.length-1)/2)),Math.round(u/E+Math.floor((o.length-1)/2))])}},l.onPlacePuzzleCallback=function(e){this.dragPuzzle&&null!=e&&(this.dragPuzzle.setPosition(this.placePuzzlePos[0],this.placePuzzlePos[1]-Math.round(e*E),0),this.placePuzzlePos=[0,0]),this.dragPuzzle=null},l.hslToRgb=function(e,t,n){var o,i,l;if(0==t)o=i=l=n;else{var r=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:s},a=n<.5?n*(1+t):n+t-n*t,s=2*n-a;o=r(s,a,e+1/3),i=r(s,a,e),l=r(s,a,e-1/3)}return[255*o,255*i,255*l]},l.generateHueColors=function(e){for(var t=[],n=0;n<e;n++){var o=n/e,i=this.hslToRgb(o,this.cellSaturation,this.cellLightness),l=i[0],r=i[1],a=i[2];t.push(new f(l,r,a))}return t},t}(p)).prototype,"cellPrefab",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(U.prototype,"cellSaturation",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),x=t(U.prototype,"cellLightness",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),m=U))||m));l._RF.pop()}}}));

System.register("chunks:///_virtual/ScreenshotController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n,i,a,o,c,l,u,s,p,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized,a=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){c=e.cclegacy,l=e._decorator,u=e.Camera,s=e.Animation,p=e.CCInteger,m=e.Component}],execute:function(){var h,f,g,d,v,y,b,C,w;c._RF.push({},"959e54MyFBP2L9Vu8M7LlBH","ScreenshotController",void 0);var x=l.ccclass,A=l.property;e("ScreenshotController",(h=x("ScreenshotController"),f=A(u),g=A({type:s}),d=A({type:p,min:1}),h((b=t((y=function(e){function t(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,n(t,"screenshotCamera",b,i(t)),n(t,"tipAnim",C,i(t)),n(t,"tipTimeLength",w,i(t)),t}r(t,e);var c=t.prototype;return c.start=function(){},c.update=function(e){},c.onScreenshotClick=function(){var e=this,t=this.screenshotCamera.targetTexture;if(t){var r=[t.width,t.height],n=r[0],i=r[1],c=t.readPixels(),l=document.createElement("canvas"),u=[n,i];l.width=u[0],l.height=u[1];for(var s=l.getContext("2d"),p=s.createImageData(n,i),m=0;m<i;m++)for(var h=0;h<n;h++){var f=4*((i-m-1)*n+h),g=4*(m*n+h);p.data.set(c.slice(f,f+4),g)}s.putImageData(p,0,0),l.toBlob(a(o().mark((function t(r){var n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=4;break}return t.next=3,navigator.clipboard.write([new ClipboardItem({"image/png":r})]);case 3:e.tipAnim&&((n=e.tipAnim.getState("fadeOut")).speed=n.duration/e.tipTimeLength,e.tipAnim.play("fadeOut"));case 4:case"end":return t.stop()}}),t)}))),"image/png")}},t}(m)).prototype,"screenshotCamera",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(y.prototype,"tipAnim",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(y.prototype,"tipTimeLength",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),v=y))||v));c._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});