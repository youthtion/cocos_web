System.register("chunks:///_virtual/BuffController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts"],(function(t){var e,f,u,i,s,n,r,B,a,h,b,l,_,o;return{setters:[function(t){e=t.applyDecoratedDescriptor,f=t.inheritsLoose,u=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){s=t.cclegacy,n=t._decorator,r=t.Node,B=t.Label,a=t.CCInteger,h=t.Component},function(t){b=t.GameModel,l=t.MAX_BOARD_LENGTH,_=t.MIN_BOARD_LENGTH,o=t.ADD_NEAR_RATE}],execute:function(){var L,T,c,E,p,R,g,O,S,A,C,z,G,y,U,m,Z,d,N,P,D;s._RF.push({},"efd9cZ2vtdGkZunZzVclwQC","BuffController",void 0);var F=n.ccclass,M=n.property,v=function(t){return t[t.BT_GROW_STOP=0]="BT_GROW_STOP",t[t.BT_GROW_DEC=1]="BT_GROW_DEC",t[t.BT_SMALLER_PUZZLE=2]="BT_SMALLER_PUZZLE",t[t.BT_BIGGER_PUZZLE=3]="BT_BIGGER_PUZZLE",t[t.BT_LESS_HUE=4]="BT_LESS_HUE",t[t.BT_MORE_HUE=5]="BT_MORE_HUE",t[t.BT_ADD_OBSTACLE=6]="BT_ADD_OBSTACLE",t[t.BT_DEC_OBSTACLE=7]="BT_DEC_OBSTACLE",t[t.BT_GET_1X1_PUZZLE=8]="BT_GET_1X1_PUZZLE",t[t.BT_CANNOT_ROTATE=9]="BT_CANNOT_ROTATE",t[t.BT_LESS_BUFF=10]="BT_LESS_BUFF",t[t.BT_MORE_BUFF=11]="BT_MORE_BUFF",t[t.BT_MORE_REFRESH=12]="BT_MORE_REFRESH",t[t.BT_GRAVITY=13]="BT_GRAVITY",t}(v||{});t("BuffController",(L=F("BuffController"),T=M({type:r}),c=M({type:B}),E=M({type:r}),p=M({type:r}),R=M({type:r}),g=M({type:B}),O=M({type:B}),S=M({type:B}),A=M({type:a}),L((G=e((z=function(t){function e(){for(var e,f=arguments.length,s=new Array(f),n=0;n<f;n++)s[n]=arguments[n];return e=t.call.apply(t,[this].concat(s))||this,u(e,"refreshBtn",G,i(e)),u(e,"freshLabel",y,i(e)),u(e,"buffBtn1",U,i(e)),u(e,"buffBtn2",m,i(e)),u(e,"buffBtn3",Z,i(e)),u(e,"buffLabel1",d,i(e)),u(e,"buffLabel2",N,i(e)),u(e,"buffLabel3",P,i(e)),u(e,"buffSpace",D,i(e)),e.buffBtns=[],e.buffLabels=[],e.buffList=[],e.buffNum=2,e.refreshNum=0,e.buffText=["下關底板停止成長","底板縮小","方塊容易變小","方塊容易變大","方塊色差減少\n刷新效果","方塊色差增加","底板缺格增加","底板缺格減少","獲得1x1方塊","下關不可旋轉方塊\n出現底板縮小效果","減少選擇數量\n出現底板縮小效果","增加選擇數量","獲得額外刷新次數","下關產生重力\n刷新效果"],e}f(e,t);var s=e.prototype;return s.start=function(){this.buffBtn1&&this.buffBtns.push(this.buffBtn1),this.buffBtn2&&this.buffBtns.push(this.buffBtn2),this.buffBtn3&&this.buffBtns.push(this.buffBtn3),this.buffLabel1&&this.buffLabels.push(this.buffLabel1),this.buffLabel2&&this.buffLabels.push(this.buffLabel2),this.buffLabel3&&this.buffLabels.push(this.buffLabel3)},s.update=function(t){},s.showBuffBtn=function(){for(var t=0;t<this.buffBtns.length;t++)this.buffNum>t?(this.buffBtns[t].active=!0,this.buffBtns[t].setPosition(this.buffSpace*(this.buffNum-1)*-.5+t*this.buffSpace,0,0),this.buffLabels[t].string=this.buffText[this.buffList[t]]):this.buffBtns[t].active=!1;this.refreshBtn&&(this.refreshBtn.active=this.refreshNum>0,this.freshLabel&&(this.freshLabel.string=""+this.refreshNum))},s.onBuff1Click=function(){this.setBuff(this.buffList[0])},s.onBuff2Click=function(){this.setBuff(this.buffList[1])},s.onBuff3Click=function(){this.setBuff(this.buffList[2])},s.onRefreshClick=function(){this.refreshNum-=1,this.generateBuffList(),this.showBuffBtn()},s.getBuffAddNearRate=function(){for(var t=o.slice(),e=2;e<t.length;e++)t[e]+=.1*b.getPuzzleSizeBuff(),t[e]>1?t[e]=1:t[e]<0&&(t[e]=0);return t},s.setBuff=function(t){switch(t){case v.BT_GROW_STOP:break;case v.BT_GROW_DEC:b.setBoardLength(b.getBoardLength()-1);break;case v.BT_SMALLER_PUZZLE:b.setPuzzleSizeBuff(b.getPuzzleSizeBuff()-1);break;case v.BT_BIGGER_PUZZLE:b.setPuzzleSizeBuff(b.getPuzzleSizeBuff()+1);break;case v.BT_LESS_HUE:return b.setLessHueBuff(b.getLessHueBuff()+1),this.generateBuffList(),void this.showBuffBtn();case v.BT_MORE_HUE:b.setLessHueBuff(b.getLessHueBuff()-1);break;case v.BT_ADD_OBSTACLE:b.setObstacleBuff(b.getObstacleBuff()+1);break;case v.BT_DEC_OBSTACLE:b.setObstacleBuff(b.getObstacleBuff()-1);break;case v.BT_GET_1X1_PUZZLE:b.setOnecellBuff(b.getOnecellBuff()+1);break;case v.BT_CANNOT_ROTATE:return b.setCannotRotateBuff(!0),this.generateBuffList(),this.buffList[0]=v.BT_GROW_DEC,void this.showBuffBtn();case v.BT_LESS_BUFF:return this.buffNum-=1,this.generateBuffList(),this.buffList[0]=v.BT_GROW_DEC,void this.showBuffBtn();case v.BT_MORE_BUFF:return this.buffNum+=1,this.generateBuffList(),void this.showBuffBtn();case v.BT_MORE_REFRESH:this.refreshNum+=1;break;case v.BT_GRAVITY:return b.setGravityBuff(!0),this.generateBuffList(),void this.showBuffBtn()}t>v.BT_GROW_DEC&&b.setBoardLength(b.getBoardLength()+1),this.node.emit("onSetBuffFinish")},s.generateBuffList=function(){this.buffList=[],b.getBoardLength()<l&&this.buffList.push(v.BT_GROW_STOP),b.getPuzzleSizeBuff()>-3&&this.buffList.push(v.BT_SMALLER_PUZZLE),b.getPuzzleSizeBuff()<3&&this.buffList.push(v.BT_BIGGER_PUZZLE),this.buffList.push(v.BT_LESS_HUE),b.getLessHueBuff()>1&&this.buffList.push(v.BT_MORE_HUE),b.getObstacleBuff()<4&&this.buffList.push(v.BT_ADD_OBSTACLE),b.getObstacleBuff()>0&&this.buffList.push(v.BT_DEC_OBSTACLE),b.getOnecellBuff()<5&&this.buffList.push(v.BT_GET_1X1_PUZZLE),b.getBoardLength()>_&&(b.getCannotRotateBuff()||this.buffList.push(v.BT_CANNOT_ROTATE),this.buffNum>1&&this.buffList.push(v.BT_LESS_BUFF)),this.buffNum<3&&this.buffList.push(v.BT_MORE_BUFF),this.buffList.push(v.BT_MORE_REFRESH),b.getGravityBuff()||this.buffList.push(v.BT_GRAVITY);for(var t=0;t<this.buffList.length;t++){var e=Math.floor(Math.random()*(this.buffList.length-t))+t,f=[this.buffList[e],this.buffList[t]];this.buffList[t]=f[0],this.buffList[e]=f[1]}},e}(h)).prototype,"refreshBtn",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=e(z.prototype,"freshLabel",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(z.prototype,"buffBtn1",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(z.prototype,"buffBtn2",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=e(z.prototype,"buffBtn3",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=e(z.prototype,"buffLabel1",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(z.prototype,"buffLabel2",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(z.prototype,"buffLabel3",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(z.prototype,"buffSpace",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C=z))||C));s._RF.pop()}}}));

System.register("chunks:///_virtual/GameController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts","./PuzzleController.ts","./BuffController.ts"],(function(t){var e,l,n,r,i,a,o,u,s,f,h,z,c,p,g,v,b,d,C;return{setters:[function(t){e=t.applyDecoratedDescriptor,l=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){i=t.cclegacy,a=t._decorator,o=t.Prefab,u=t.Node,s=t.Label,f=t.instantiate,h=t.Sprite,z=t.Component},function(t){c=t.GameModel,p=t.CELL_WIDTH,g=t.OBSTACLE_COLOR,v=t.BOARD_COLOR,b=t.ADD_NEAR_RATE},function(t){d=t.PuzzleController},function(t){C=t.BuffController}],execute:function(){var P,m,B,y,L,F,M,R,S,A,k,w,O,E,_,N,D;i._RF.push({},"7e675OHFblFTawCzOgyllbA","GameController",void 0);var G=a.ccclass,I=a.property;t("GameController",(P=G("GameController"),m=I({type:o}),B=I({type:d}),y=I({type:C}),L=I({type:u}),F=I({type:u}),M=I({type:s}),R=I({type:s}),P((k=e((A=function(t){function e(){for(var e,l=arguments.length,i=new Array(l),a=0;a<l;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i))||this,n(e,"cellPrefab",k,r(e)),n(e,"puzzleCtrl",w,r(e)),n(e,"buffCtrl",O,r(e)),n(e,"startMenu",E,r(e)),n(e,"btnStart",_,r(e)),n(e,"titleLabel",N,r(e)),n(e,"stageLabel",D,r(e)),e}l(e,t);var i=e.prototype;return i.start=function(){var t;null==(t=this.buffCtrl)||t.node.on("onSetBuffFinish",this.onStartButtonClicked,this)},i.restart=function(){var t,e;this.setMenuVisible(!1),this.stageLabel&&(this.stageLabel.string="Stage"+c.getStage()),this.initBoard(),null==(t=this.puzzleCtrl)||t.initPuzzle(),null==(e=this.puzzleCtrl)||e.setEventsActive(!0),this.setEventsActive(!0)},i.pause=function(){var t,e,l;this.setMenuVisible(!0),this.btnStart&&(this.btnStart.active=!1),this.titleLabel&&(this.titleLabel.string=""),this.stageLabel&&(this.stageLabel.string=""),null==(t=this.buffCtrl)||t.generateBuffList(),null==(e=this.buffCtrl)||e.showBuffBtn(),c.setStage(c.getStage()+1),c.setCannotRotateBuff(!1),c.setGravityBuff(!1),this.setEventsActive(!1),null==(l=this.puzzleCtrl)||l.setEventsActive(!1)},i.update=function(t){},i.setEventsActive=function(t){var e,l,n,r,i,a;t?(null==(e=this.puzzleCtrl)||e.node.on("onFitPuzzle",this.onFitPuzzle,this),null==(l=this.puzzleCtrl)||l.node.on("onFallPuzzle",this.onFallPuzzle,this),null==(n=this.puzzleCtrl)||n.node.on("onRemovePuzzle",this.onRemovePuzzle,this)):(null==(r=this.puzzleCtrl)||r.node.off("onFitPuzzle",this.onFitPuzzle,this),null==(i=this.puzzleCtrl)||i.node.off("onFallPuzzle",this.onFallPuzzle,this),null==(a=this.puzzleCtrl)||a.node.off("onRemovePuzzle",this.onRemovePuzzle,this))},i.initBoard=function(){if(this.cellPrefab){var t=c.getBoardLength(),e=[];this.node.removeAllChildren();var l=new Set;if(c.getObstacleBuff()>0)for(var n=c.getObstacleBuff(),r=Math.floor(t*t/n),i=0;i<n;i++)l.add(Math.floor(Math.random()*r)+r*i);for(var a=0;a<t;a++){for(var o=[],u=0;u<t;u++){var s=f(this.cellPrefab);if(s){this.node.addChild(s),s.setPosition(a*p,u*p,0);var z=s.getComponent(h);l.size>0&&l.has(a*t+u)?(z&&(z.color=g),o.push(1/0)):(z&&(z.color=v),o.push(-1))}}e.push(o)}c.setBoard(e);var b=t*p*-.5+.5*p;this.node.setPosition(b,b,0),this.generatePuzzle(e)}},i.generatePuzzle=function(t){for(var e=[],l=c.getOnecellBuff(),n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)if(-1==t[n][r]){var i=e.length;if(e.push([[n,r]]),l>0)t[n][r]=1/0,l--;else if(t[n][r]=i,this.addNearCell(e,t),e[i].length<=1){var a=e[i][0],o=a[0],u=a[1],s=this.findNearPuzzle(t,o,u);e[s].push(e[i][0]),e.pop(),t[o][u]=s}}c.setPuzzles(e)},i.addNearCell=function(t,e){for(var l=t.length-1,n=t[l],r=e.map((function(t){return t.slice()})),i=[],a=[[1,0],[0,1]],o=0;o<n.length;o++)for(var u=n[o],s=u[0],f=u[1],h=0;h<a.length;h++){var z=a[h],c=s+z[0],p=f+z[1];c<r.length&&p<r[c].length&&-1==r[c][p]&&(i.push([c,p]),r[c][p]=0)}if(i.length>0&&n.length<b.length){var g,v=null==(g=this.buffCtrl)?void 0:g.getBuffAddNearRate().slice();if(Math.random()<v[n.length]){var d=Math.floor(Math.random()*i.length),C=i[d],P=C[0],m=C[1];t[l].push(i[d]),e[P][m]=l,this.addNearCell(t,e)}}},i.findNearPuzzle=function(t,e,l){for(var n=[[-1,0],[1,0],[0,1],[0,-1]],r=[],i=0;i<n.length;i++){var a=n[i],o=e+a[0],u=l+a[1];o>=0&&u>=0&&o<t.length&&u<t[o].length&&t[o][u]>-1&&t[o][u]!=1/0&&r.push([o,u])}if(r.length>0){var s=r[Math.floor(Math.random()*r.length)],f=s[0],h=s[1];return t[f][h]}return 0},i.onFallPuzzle=function(t,e){for(var l,n=1/0,r=0;r<t.length;r++)t[r][1]<n&&(n=t[r][1]);for(var i=c.getBoard().map((function(t){return t.slice()})),a=-1,o=0;o<=n;o++){for(var u=0,s=0;s<t.length;s++){var f=t[s],h=f[0],z=f[1];if(-1!=i[h][z-o])break;u++}if(u!=t.length)break;a=o}if(-1!=a){for(var p=parseInt(e),g=0;g<t.length;g++){var v=t[g],b=v[0],d=v[1];i[b][d-a]=p}c.setBoard(i),null==(l=this.puzzleCtrl)||l.onFallPuzzleCallback(a),this.checkResult(i)}else{var C;null==(C=this.puzzleCtrl)||C.onFitPuzzleCallback(!1)}},i.onFitPuzzle=function(t,e){for(var l,n=parseInt(e),r=c.getBoard().map((function(t){return t.slice()})),i=0;i<t.length;i++){var a,o=t[i],u=o[0],s=o[1];if(-1!=r[u][s])return void(null==(a=this.puzzleCtrl)||a.onFitPuzzleCallback(!1));r[u][s]=n}c.setBoard(r),null==(l=this.puzzleCtrl)||l.onFitPuzzleCallback(!0),this.checkResult(r)},i.onRemovePuzzle=function(t,e){for(var l=parseInt(e),n=c.getBoard().map((function(t){return t.slice()})),r=0;r<t.length;r++){var i=t[r],a=i[0],o=i[1];if(n[a][o]!=l)return;n[a][o]=-1}c.setBoard(n)},i.onStartButtonClicked=function(){this.restart()},i.checkResult=function(t){for(var e=0;e<t.length;e++)for(var l=0;l<t[e].length;l++)if(-1==t[e][l])return;this.pause()},i.setMenuVisible=function(t){this.startMenu&&(this.startMenu.active=t)},e}(z)).prototype,"cellPrefab",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(A.prototype,"puzzleCtrl",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(A.prototype,"buffCtrl",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(A.prototype,"startMenu",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(A.prototype,"btnStart",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(A.prototype,"titleLabel",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(A.prototype,"stageLabel",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=A))||S));i._RF.pop()}}}));

System.register("chunks:///_virtual/GameModel.ts",["cc"],(function(t){var e,n;return{setters:[function(t){e=t.cclegacy,n=t.Color}],execute:function(){e._RF.push({},"3ed4fPz+JtG/7O1tueJ7qje","GameModel",void 0);var u=t("CELL_WIDTH",60),f=(t("FIT_ALLOW",Math.floor(u/4)),t("BOARD_COLOR",new n(64,64,64)),t("OBSTACLE_COLOR",new n(0,0,0)),t("ADD_NEAR_RATE",[1,1,1,.7,.5,.3]),t("MAX_BOARD_LENGTH",10)),i=t("MIN_BOARD_LENGTH",3),s=t("CGameModel",function(){function t(){this.boardLength=i,this.stage=1,this.board=[],this.puzzles=[],this.puzzleSizeBuff=0,this.lessHueBuff=1,this.cannotRotateBuff=!1,this.obstacleBuff=0,this.onecellBuff=0,this.gravityBuff=!1}var e=t.prototype;return e.setBoardLength=function(t){t>f&&(t=f),this.boardLength=t},e.setStage=function(t){this.stage=t},e.setBoard=function(t){this.board=t.map((function(t){return t.slice()}))},e.setPuzzles=function(t){this.puzzles=t.map((function(t){return t.map((function(t){return t.slice()}))}))},e.setPuzzleSizeBuff=function(t){this.puzzleSizeBuff=t},e.setLessHueBuff=function(t){this.lessHueBuff=t},e.setCannotRotateBuff=function(t){this.cannotRotateBuff=t},e.setObstacleBuff=function(t){this.obstacleBuff=t},e.setOnecellBuff=function(t){this.onecellBuff=t},e.setGravityBuff=function(t){this.gravityBuff=t},e.getBoardLength=function(){return this.boardLength},e.getStage=function(){return this.stage},e.getBoard=function(){return this.board},e.getPuzzles=function(){return this.puzzles},e.getPuzzleSizeBuff=function(){return this.puzzleSizeBuff},e.getLessHueBuff=function(){return this.lessHueBuff},e.getCannotRotateBuff=function(){return this.cannotRotateBuff},e.getObstacleBuff=function(){return this.obstacleBuff},e.getOnecellBuff=function(){return this.onecellBuff},e.getGravityBuff=function(){return this.gravityBuff},t}());t("GameModel",new s);e._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./BuffController.ts","./GameController.ts","./GameModel.ts","./PuzzleController.ts"],(function(){return{setters:[null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PuzzleController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameModel.ts"],(function(e){var t,n,i,o,l,r,s,a,u,h,f,z,g,c,P,p,d,M,v,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){l=e.cclegacy,r=e._decorator,s=e.Prefab,a=e.CCFloat,u=e.input,h=e.Input,f=e.Vec3,z=e.UITransform,g=e.Color,c=e.Node,P=e.instantiate,p=e.Sprite,d=e.Component},function(e){M=e.GameModel,v=e.CELL_WIDTH,y=e.FIT_ALLOW}],execute:function(){var C,b,T,m,S,E,_,U,x;l._RF.push({},"4b28053qTlNFqEjoH7O1aS0","PuzzleController",void 0);var I=r.ccclass,L=r.property,F=function(e){return e[e.MT_LEFT=0]="MT_LEFT",e[e.MT_MID=1]="MT_MID",e[e.MT_RIGHT=2]="MT_RIGHT",e}(F||{});e("PuzzleController",(C=I("PuzzleController"),b=L({type:s}),T=L({type:a,min:0,max:1,step:.01}),m=L({type:a,min:0,max:1,step:.01}),C((_=t((E=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return t=e.call.apply(e,[this].concat(l))||this,i(t,"cellPrefab",_,o(t)),i(t,"cellSaturation",U,o(t)),i(t,"cellLightness",x,o(t)),t.fitCells=[],t.fitPuzzlePos=[0,0],t.dragPuzzle=null,t.dragStartPos=new f,t.puzzleStartPos=new f,t}n(t,e);var l=t.prototype;return l.start=function(){},l.update=function(e){},l.setEventsActive=function(e){e?(u.on(h.EventType.MOUSE_MOVE,this.onMouseMove,this),u.on(h.EventType.MOUSE_UP,this.onMouseUp,this)):(u.off(h.EventType.MOUSE_MOVE,this.onMouseMove,this),u.off(h.EventType.MOUSE_UP,this.onMouseUp,this))},l.initPuzzle=function(){var e=this;if(this.cellPrefab){var t=M.getBoard(),n=M.getPuzzles().map((function(e){return e.map((function(e){return e.slice()}))})),i=this.generateHueColors(n.length*M.getLessHueBuff());this.node.removeAllChildren();for(var o=function(){for(var o=new c(""+l),r=n[l][0],s=r[0],a=r[1],u=0;u<n[l].length;u++){var z=P(e.cellPrefab);if(z){o.addChild(z);var g=n[l][u],d=g[0],y=g[1];z.setPosition((d-s)*v,(y-a)*v,0);var C=z.getComponent(p);C&&(C.color=i[l]),z.on(h.EventType.MOUSE_DOWN,(function(t){e.onMouseDown(t,o)}),e),z.on(h.EventType.MOUSE_MOVE,e.onMouseMove,e),z.on(h.EventType.MOUSE_UP,e.onMouseUp,e)}}M.getCannotRotateBuff()||(o.eulerAngles=new f(o.eulerAngles.x,o.eulerAngles.y,o.eulerAngles.z+90*Math.floor(4*Math.random()))),o.setPosition(t.length*v*-1,0,0),e.node.addChild(o)},l=0;l<n.length;l++)o()}},l.onMouseDown=function(e,t){if(t.parent)if(t.setSiblingIndex(t.parent.children.length-1),this.getFitCell(t),this.fitCells.length==t.children.length&&this.node.emit("onRemovePuzzle",this.fitCells,t.name),M.getCannotRotateBuff()||e.getButton()!=F.MT_RIGHT)e.getButton()!=F.MT_LEFT||this.dragPuzzle||(this.puzzleStartPos.set(t.getPosition()),this.dragStartPos.set(e.getUILocation().x,e.getUILocation().y,0),this.dragPuzzle=t);else{var n=new f(e.getUILocation().x,e.getUILocation().y,0),i=t.parent.getComponent(z).convertToNodeSpaceAR(n),o=t.getPosition(),l=new f(i.x-o.x,i.y-o.y,0),r=[Math.cos(Math.PI/-2),Math.sin(Math.PI/-2)],s=r[0],a=r[1],u=l.x*s-l.y*a,h=l.x*a+l.y*s,g=i.x-u,c=i.y-h;t.setPosition(g,c,0),t.eulerAngles=new f(t.eulerAngles.x,t.eulerAngles.y,(t.eulerAngles.z-90)%360)}},l.onMouseMove=function(e){if(this.dragPuzzle){var t=e.getUILocation(),n=this.dragStartPos.x-t.x,i=this.dragStartPos.y-t.y;this.dragPuzzle.setPosition(this.puzzleStartPos.x-n,this.puzzleStartPos.y-i)}},l.onMouseUp=function(e){if(this.dragPuzzle){if(this.getFitCell(this.dragPuzzle),this.fitCells.length==this.dragPuzzle.children.length)return void(M.getGravityBuff()?this.node.emit("onFallPuzzle",this.fitCells,this.dragPuzzle.name):this.node.emit("onFitPuzzle",this.fitCells,this.dragPuzzle.name));this.dragPuzzle=null}},l.getFitCell=function(e){var t=0,n=0;if(this.fitCells=[],e.parent)for(var i=M.getBoard(),o=0;o<e.children.length;o++){var l=e.children[o].getWorldPosition(),r=e.parent.getComponent(z).convertToNodeSpaceAR(l),s=[r.x,r.y],a=s[0],u=s[1];if(Math.abs(a)>v*(i.length-1)/2+y||Math.abs(u)>v*(i.length-1)/2+y)break;if(i.length%2==0){var h=[a+.5*v,u+.5*v];a=h[0],u=h[1]}if(Math.abs(a%v)>y&&Math.abs(a%v)<v-y)break;if(Math.abs(u%v)>y&&Math.abs(u%v)<v-y)break;if(0==t&&0==n){(t=(a%v+v)%v)>y&&(t-=v),(n=(u%v+v)%v)>y&&(n-=v);var f=e.getPosition();this.fitPuzzlePos=[f.x-t,f.y-n]}var g=[a-t,u-n];a=g[0],u=g[1],this.fitCells.push([Math.round(a/v+Math.floor((i.length-1)/2)),Math.round(u/v+Math.floor((i.length-1)/2))])}},l.onFitPuzzleCallback=function(e){this.dragPuzzle&&e&&(this.dragPuzzle.setPosition(this.fitPuzzlePos[0],this.fitPuzzlePos[1],0),this.fitPuzzlePos=[0,0]),this.dragPuzzle=null},l.onFallPuzzleCallback=function(e){this.dragPuzzle&&(this.dragPuzzle.setPosition(this.fitPuzzlePos[0],this.fitPuzzlePos[1]-Math.round(e*v),0),this.fitPuzzlePos=[0,0]),this.dragPuzzle=null},l.hslToRgb=function(e,t,n){var i,o,l;if(0==t)i=o=l=n;else{var r=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:a},s=n<.5?n*(1+t):n+t-n*t,a=2*n-s;i=r(a,s,e+1/3),o=r(a,s,e),l=r(a,s,e-1/3)}return[255*i,255*o,255*l]},l.generateHueColors=function(e){for(var t=[],n=0;n<e;n++){var i=n/e,o=this.hslToRgb(i,this.cellSaturation,this.cellLightness),l=o[0],r=o[1],s=o[2];t.push(new g(l,r,s))}return t},t}(d)).prototype,"cellPrefab",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(E.prototype,"cellSaturation",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),x=t(E.prototype,"cellLightness",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S=E))||S));l._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});